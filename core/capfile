role :e, 'root@e.easya.cc'
namespace :play do

  desc "部署 Play 代码到服务器"
  task :deploy, roles: :e do
    branch = `git branch | grep \\*`.split(' ')[1]
    if branch != 'master'
      puts "请确认 git 分支在 master 分支 (now:#{branch})"
      exit
    end
    puts '---- push to unfuddle ----'
    `git push ufd`
    puts '---- push to bitbucket ----'
    `git push bit`
    run "cd ~/elcuk2/core;git checkout master;git pull;play deps --sync;play stop;play start --%prod;tail log/elcuk2.log"
  end
end
