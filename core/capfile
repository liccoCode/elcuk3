role :e, 'root@pangoro.easya.cc'
namespace :play do

  desc "Push Code"
  task :push do
    `git push origin`

  end

  desc "部署 Play 代码到服务器"
  task :deploy, roles: :e do
    branch = `git branch | grep \\*`.split(' ')[1]
    if branch != 'master'
      puts "请确认 git 分支在 master 分支 (now:#{branch})"
      exit
    end
    puts '---- push to unfuddle ----'
    `git push ufd`
    puts '---- push to bitbucket ----'
    `git push origin`
    # 最后多查看两次 logs
    look = "sleep 3;tail logs/elcuk2.log;"
    run "cd ~/elcuk2/core;git checkout master;git pull;play deps --sync;play stop;sleep 2;#{play_start};#{look * 3}"
  end

  def play_start
    'play start --%prod -javaagent:/root/elcuk2/core/newrelic/newrelic.jar'
  end
end
