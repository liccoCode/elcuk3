<table class="table table-condensed table-bordered">
    <tr>
        <th>#</th>
        <th>UserId</th>
        <th>Create</th>
        <th>LastMsg</th>
        <th>Email</th>
        <th>Order</th>
        <th>OsTicket</th>
        <th>Buyer</th>
        <th>Score</th>
    </tr>

#{list items:tickets, as:'t'}
    #{set f:t.feedback/}
    <tr>
        <td>${t.id}</td>
        <td>
            <a href="${f.userReviewLink(f.orderr.userid)}" target="_blank"><i class="icon-external-link"></i> ${f.orderr.userid}</a>
        </td>
        <td>${f.createDate.since()}</td>
        <td>
            #{if t.lastMessageTime}
            ${t.lastMessageTime.since()}
            #{/if}
            #{else }
                <i class="icon-warning-sign"></i>
            #{/else}
        </td>

        <td data-toggle='toggle' data-target="#toggle_${t.id}" style="cursor:pointer;background:${'#' + f.color()}">
            <span class="badge badge-inverse">${f.length()}</span>
            <span>${f.email}</span>
            #{list items:t.reasons, as:'tag'}
                <span class="badge badge-important">${tag.name()}</span>
            #{/list}

            <span class="pull-right badge badge-info">${t.responseTimes}</span>
            <span class="pull-right badge badge-warning">${t.messageTimes}</span>

            <!-- 这个是此 Ticket 的处理者 -->
            #{if t.resolver}
                <span class="pull-right badge badge-inverse"><i class="icon-user"></i> ${t.resolver.username.capAll()}</span>
            #{/if}
        </td>
        <td>
            <a href="@{Feedbacks.show(t.fid)}" target="_blank">${t.fid}</a>
            <i class="pull-right icon-shopping-cart"></i>
        </td>
        <td>
            #{if t.osTicketId()}
                <a href="${t.osTicketLink()}" target="_blank">
                    <i class="icon-external-link"></i> ${t.osTicketId()}
                </a>
            #{/if}
            #{else }
                <i class="icon-warning-sign"></i>
            #{/else}
        </td>
        <td>
            #{ifnot f.orderr.buyer}<i class='icon-warning-sign'></i>#{/ifnot}
            <a href="${f.orderr.orderLink()}" target="_blank"><i class="icon-external-link"></i> ${f.orderr.buyer}</a>
        </td>
        <td style="background:${'#' + f.score.color()}">${f.score}</td>
    </tr>
    <tr id="toggle_${t.id}" style="display:none;">
        <td colspan="9">
            <ul class="nav nav-tabs" style="margin-bottom:3px;">
                <li class="active"><a href="#feedback_${t.id}" data-toggle="tab">Review</a></li>
                <li><a href="#close_${t.id}" data-toggle="tab">Close</a></li>
            </ul>

            <div class="tab-content" id="tab_content_${t.id}">
                <div id="feedback_${t.id}" class="tab-pane fade in active" style="background:#fff;">
                    <div class="alert alert-info">
                        <h4>Comment</h4>

                        <p>${f.feedback.raw()}</p>
                    </div>
                    <div class="alert alert-success">
                        <h4>Feedback Memo</h4>

                        <p>${f.memo.raw()}</p>
                    </div>
                    <div class="alert alert-info">
                        <h4>Ticket Memo</h4>

                        <p>${t.memo}</p>
                    </div>
                </div>

                <div id="close_${t.id}" class="tab-pane fade" style="background:#fff;">
                    <div class="row-fluid">
                        <div class="span12" style="margin-top:10px;">
                            #{if t.state != models.support.TicketState.CLOSE}
                                <textarea rows="4" id="close_reason_${t.id}" class="span12" placeHolder="输入关闭这个 Ticket 的理由, 必须填写"></textarea>

                                #{if t.reasons.size() == 0}
                                    <span class="alert alert-danger">需要先指定原因才可以关闭</span>
                                #{/if}
                                #{else }
                                    <button tid="${t.id}" class="close_btn btn btn-danger">Close</button>
                                #{/else}
                            #{/if}
                            #{else }
                                已经关闭了
                            #{/else}
                        </div>
                    </div>
                </div>
            </div>
        </td>
    </tr>
#{/list}
</table>