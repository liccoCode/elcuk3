#{extends 'main_full.html' /}
#{set title:'运输丢失率统计报表'/}
#{set 'moreScripts'}
    #{script 'jquery.dataTables.js'/}
    #{script 'ShipmentReports/lossRate.coffee'/}
#{/set}

#{info_row}
<ul>
  <li><strong>运输丢失率统计报表</strong></li>
</ul>
#{/info_row}
#{flash_alert /}

<form action="@{ShipmentReports.lossRateReport()}" method="get" class="search_form" id='search_form'>
  <div class="row-fluid">
    <div class="span12">
      <div class="input-prepend inline">
        运输单:
        <span class="add-on">From:</span>
        <input type="date" name="p.from" value="${p.from.date()}">
      </div>

      <div class="input-prepend inline">
        <span class="add-on">To:</span>
        <input type="date" name="p.to" value="${p.to.date()}">
      </div>

      <div class="input-append input-prepend inline">
        <button class="btn btn-primary" data-loading>统计</button>
        <button class="btn btn-primary" id="exceldown">导出未完全入库统计Excel</button>
      </div>
    </div>
  </div>
</form>

<ul class="nav nav-tabs">
  <li class="active">
    <a href="#" data-toggle='tab' id="firstTab">未完全入库统计</a>
  </li>
  <li>
    <a href="#" data-toggle='tab' id="secondTab">赔偿统计</a>
  </li>
</ul>


<div id="below_tabContent" class="tab-content">
  <div class="tab-pane active in" id='activeprocess'>
    <div class="row-fluid">
      <div class="span12">
        <table id="shipItemTable" class="table table-condensed table-bordered">
          <thead>
          <tr>
            <th>selling</th>
            <th>FBA</th>
            <th>CenterID</th>
            <th>Qty</th>
            <th>Receive</th>
            <th>Qty1</th>
            <th>采购单</th>
            <th>预计发货时间</th>
            <th>预计到库时间</th>
            <th>实际交货时间</th>
            <th>供应商</th>
            <th>少货数量(个)</th>
            <th>赔偿类型</th>
            <th>采购成本(USD)</th>
            <th>物流成本(USD)</th>
            <th>损失金额(USD)</th>
            <th>备注</th>
          </tr>
          </thead>
          <tbody>
          #{list items:shipItems, as:'itm'}
          <tr>
            <td>${itm.unit.sid}</td>
            <td>${itm.unit.fba?.shipmentId}</td>
            <td>${itm.unit.fba?.centerId}</td>
            <td>${itm.qty} (${itm.unit.attrs.planQty} | ${itm.unit.attrs.qty})</td>
            <td>${itm.recivedQty}</td>
            <td>${itm.adjustQty}</td>
            <td>${itm.showDeliverymentId()}</td>
            <td>#{time_tooltip time: itm.unit.attrs.planShipDate/}</td>
            <td>#{time_tooltip time: itm.unit.attrs.planArrivDate/}</td>
            <td>#{time_tooltip time: itm.unit.attrs.deliveryDate/}</td>
            <td>${itm.unit.cooperator?.name}</td>
            <td>${itm.lossqty}</td>
            <td>${itm.compentype}</td>
            <td>${itm.purchaseCost}</td>
            <td>${itm.shipmentCost}</td>
            <td>${itm.lossCost}</td>
            <td>${itm.memo}</td>
          </tr>
          #{/list}
          </tbody>
        </table>
      </div>
    </div>
  </div>


  <div class="tab-pane" id='runprocess' data-method="ajaxRunPocesss">
    <div class="row-fluid">
      <div class="span12">
        <b style="color:#0e90d2">赔偿统计</b>
        <table id="losstotal" class="table table-condensed table-bordered">
          <thead>
          <tr>
            <th>总丢失量</th>
            <th>总运输量</th>
            <th>丢失率%</th>
            <th>总赔偿金额(单位: USD)</th>
            <th>丢失量的总采购成本金额(USD)</th>
            <th>丢失量的物流成本金额(USD)</th>
            <th>赔偿比例(%)</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td>${losstotal.totalqty}</td>
            <td>${losstotal.shipqty}</td>
            <td>${losstotal.lossrate}</td>
            <td>${losstotal.totalamt}</td>
            <td>${losstotal.totallossprice}</td>
            <td>${losstotal.totalShipmentprice}</td>
            <td>${losstotal.payrate} %</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span12">
        <table id="lossrate" class="table table-condensed table-bordered">
          <thead>
          <tr>
            <th>FBA</th>
            <th>SKU</th>
            <th>运输量</th>
            <th>丢失量</th>
            <th>赔偿类型</th>
            <th>赔偿金额(单位: USD)</th>
            <th>丢失量的总采购成本金额（USD）</th>
            <th>丢失量的物流成本金额（USD）</th>
            <th>赔偿比例(%)</th>
          </tr>
          </thead>
          <tbody>
          #{list items:lossrates, as:'loss'}
          <tr>
            <td>${loss.fba}</td>
            <td>${loss.sku}</td>
            <td>${loss.qty}</td>
            <td>${loss.lossqty}</td>
            <td>${loss.c}</td>
            <td>${loss.compenusdamt}</td>
            <td>${loss.totallossprice}</td>
            <td>${loss.totalShipmentprice}</td>
            <td>${loss.payrate} %</td>
          </tr>
          #{/list}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>