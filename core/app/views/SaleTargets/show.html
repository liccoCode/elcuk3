#{extends 'main.html' /}
#{set title:"年度销售目标#" + yearSt.id /}
#{set 'moreScripts'}
    #{script_cdn name: 'saleTargets/blank.coffee'/}
#{/set}

#{errorMsgs /}
#{flash_alert /}

<div class="row">
  <div class="span12">
    <form action="@{SaleTargets.update(yearSt.id)}" method="POST" id="saleTargetsForm">
    #{info_row title:'总年度目标'/}
      <table class="table table-bordered">
        <tr>
          <th>年份</th>
          <td>
          #{select_year  name: "yearSt.targetYear", value: yearSt.targetYear, disabled:true/}
          </td>
        </tr>

        <tr>
          <th>目标名称</th>
          <td colspan="4">
            <input type="text" class="span10" name="yearSt.name" value="${yearSt.name}">
          </td>
        </tr>

        <tr>
          <th>销售额</th>
          <td>
            <div class="input-prepend input-append">
              <span class="add-on">$</span>
              <input type="text" name="yearSt.saleAmounts" value="${yearSt.saleAmounts}" readonly rel="popover"
                     content="年度销售目标的总销售额数据为各 Category 销售额数据汇总得出" placement="right">
              <span class="add-on">万</span>
            </div>
          </td>

          <th>利润率</th>
          <td>
            <div class="input-append">
              <input type="text" name="yearSt.profitMargin" value="${yearSt.profitMargin}">
              <span class="add-on">%</span>
            </div>
          </td>
        </tr>

        <tr>
          <th>备注</th>
          <td colspan="4">
            <textarea rows="4" class="span10" name="yearSt.memo">${yearSt.memo}</textarea>
          </td>
        </tr>
      </table>

    #{info_row title:'Category 年度目标'/}
    #{if sts.size() > 0}

      <table class="table table-bordered" id="categorySaletargets">
        <tr>
          <th>Category</th>
          <th>所属 Team</th>
          <th>销售额(万)</th>
          <th>利润率</th>
          <th>操作</th>
        </tr>
      <tr>

          #{list items:sts, as:'st'}
              #{set team: st.fetchTeam()/}
            <tr>
              <td>
                <a href="@{Categorys.show(st.fid)}" target="_blank">${st.fid}</a>
                <input type="hidden" name="sts[${st_index - 1}].fid" value="${st.fid}">
              </td>
              <td><a href="@{Teams.show(team.id)}" target="_blank">${team.name}</a></td>
              <td>
                <input type="text" class="input-small" value="${st.saleAmounts}" name="sts[${st_index - 1}].saleAmounts">
              </td>
              <td>
                <div class="input-append">
                  <input type="text" class="input-mini" value="${st.profitMargin}" name="sts[${st_index - 1}].profitMargin">
                  <span class="add-on">%</span>
                </div>
              </td>
              <td>
                  #{power.ck "saletargets.split"}
                    <a class="btn btn-primary" href="@{SaleTargets.split(st.id)}">月度分解</a>
                  #{/power.ck}
              </td>
            </tr>
            <input type="hidden" name="sts[${st_index - 1}].id" value="${st.id}">
            <input type="hidden" name="sts[${st_index - 1}].saleTargetType" value="${st.saleTargetType}">
          #{/list}
        </tr>
      </table>
    #{/if}
    #{else }
      <p>当前用户没有 Category 权限</p>
    #{/else}
    </form>

    <div class="btn-toolbar">
    #{power.ck "saletargets.create"}
      <button class="btn btn-primary" id="submitSaleTargets">更新</button>
    #{/power.ck}
      <a class="btn btn-primary" href="@{SaleTargets.index()}">返回</a>
    </div>
  #{records records:records/}
  </div>
</div>
