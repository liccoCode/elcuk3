#{extends 'main_full.html'/}
#{set title:"分拆采购计划 #" + unit.id /}
#{set 'moreScripts'}
#{/set}

#{errorMsgs /}

#{info_row title:'原始采购计划' /}
<div class="row-fluid">
    <div class="span12">
        <table class="table table-condensed table-bordered">
            <tr>
                <th>#</th>
                <td>${unit.id}</td>

                <th>Selling</th>
                <td colspan="2">${unit.selling.sellingId}</td>

                <th>SKU</th>
                <td>${unit.sku}</td>
            </tr>

            <tr>
                <th>仓库</th>
                <td>${unit.whouse.name}</td>

                <th>供应商</th>
                <td colspan="2">${unit.cooperator.fullName}</td>

                <th>采购数量</th>
                <td>${unit.attrs.planQty}</td>
            </tr>

            <tr>
                <th>预计交货时间</th>
                <td>#{time_tooltip time:unit.attrs.planDeliveryDate/}</td>

                <th>预计运输时间</th>
                <td colspan="2">#{time_tooltip time:unit.attrs.planShipDate/}</td>

                <th>预计到库时间</th>
                <td>#{time_tooltip time:unit.attrs.planArrivDate/}</td>
            </tr>

            <tr>
                <th>单价</th>
                <td>${unit.attrs.price.format("#.##")} ${unit.attrs.currency.name()}</td>

                <th>阶段</th>
                <td style="background:${unit.stage.rgb()}">${unit.stage}</td>
                <td>是否到货代 #{yesOrNo f:unit.isPlaced/}</td>

                <th>采购单</th>
                <td>${unit.deliveryment.id}</td>
            </tr>

            <tr>
                <th>运输方式</th>
                <td>${unit.shipType}</td>

                <td colspan="5"></td>
            </tr>
        </table>
    </div>
</div>


#{success_row title:'分拆的计划' /}

<div class="row-fluid">
    <div class="span12">
        <form action="@{Procures.doSplitUnit()}" method="post">
        #{authenticityToken /}
            <input type="hidden" name="uid" value="${unit.id}">
            <table class="table table-condensed table-bordered">
                <tr>
                    <th>Selling</th>
                    <td>
                        <input readonly="" name="newUnit.selling.sellingId" type="text" class="input-xlarge" value="${newUnit.selling.sellingId}">
                    </td>

                    <th>SKU</th>
                    <td>
                        <input readonly="" type="text" name="newUnit.product.sku" value="${newUnit.product.sku}">
                    </td>

                    <th>供应商</th>
                    <td>
                        <input type="hidden" readonly="" name="newUnit.cooperator.id" value="${newUnit.cooperator.id}">${newUnit.cooperator.fullName}
                    </td>
                </tr>

                <tr>
                    <th>仓库</th>
                    <td>
                        <select name="newUnit.whouse.id">
                            <option value="">仓库</option>
                        #{list items:whouses, as:'wh'}
                            <option ${wh.id == newUnit.whouse?.id ? 'selected' : ''} value="${wh.id}">${wh.name}</option>
                        #{/list}
                        </select>
                    </td>

                    <th>采购数量</th>
                    <td>
                        <input type="text" name="newUnit.attrs.planQty" value="${newUnit.attrs.planQty}">
                    </td>

                    <th>单价</th>
                    <td>
                    ${newUnit.attrs.price} ${newUnit.attrs.currency.name()}
                        <input type="hidden" name="newUnit.attrs.price" value="${newUnit.attrs.price}">
                        <input type="hidden" name="newUnit.attrs.currency" value="${newUnit.attrs.currency.name()}">
                    </td>
                </tr>

                <tr>
                    <th>预计交货时间</th>
                    <td>
                        <input type="date" name="newUnit.attrs.planDeliveryDate" value="${newUnit.attrs.planDeliveryDate.date()}">
                    </td>

                    <th>预计运输时间</th>
                    <td>
                        <input type="date" name="newUnit.attrs.planShipDate" value="${newUnit.attrs.planShipDate.date()}">
                    </td>

                    <th>预计到库时间</th>
                    <td>
                        <input type="date" name="newUnit.attrs.planArrivDate" value="${newUnit.attrs.planArrivDate.date()}">
                    </td>
                </tr>

                <tr>
                    <th>阶段</th>
                    <td>
                    ${models.procure.ProcureUnit.STAGE.DELIVERY}
                        <input readonly="" type="hidden" name="newUnit.stage" value="${models.procure.ProcureUnit.STAGE.DELIVERY.name()}">
                    </td>

                    <th>是否到货代</th>
                    <td>
                    #{yesOrNo f:newUnit.isPlaced/}
                        <input type="hidden" name="newUnit.isPlaced" value="${newUnit.isPlaced}">
                    </td>

                    <th>采购单</th>
                    <td>
                    ${newUnit.deliveryment.id}
                        <input type="hidden" name="newUnit.deliveryment.id" value="${newUnit.deliveryment.id}">
                    </td>
                </tr>

                <tr>
                    <th>运输方式</th>
                    <td>
                        <select name="newUnit.shipType">
                            <option value="">请选择</option>
                        #{list items:models.procure.Shipment.T.values(), as:'t'}
                            <option ${t == newUnit.shipType ? 'selected' : ''} value="${t.name()}">${t}</option>
                        #{/list}
                        </select>
                    </td>

                    <td colspan="4"></td>
                </tr>

                <tr>
                    <td colspan="6">
                        <h4>Comment</h4>
                        <textarea rows="5" class="span12" name="newUnit.comment">${newUnit.comment.raw()}</textarea>
                    </td>
                </tr>
                <tr>
                    <td colspan="6">
                        <input type="hidden" name="newUnit.attrs.deliveryDate" value="${newUnit.attrs.deliveryDate.date()}">
                        <input type="hidden" name="id" value="${unit.id}">
                        <a href="@{Deliveryments.show(unit.deliveryment.id)}" class="btn btn-success">回到采购单</a>
                    #{ck "procures.dosplitunit"}
                        <button data-confirm="btn" content="确认分拆前, 请再确认一次分拆的数量,地址等信息" class="btn btn-primary">
                            分拆
                        </button>
                    #{/ck}
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>
