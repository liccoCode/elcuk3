#{extends 'main_full.html' /}
#{set title:"采购单元列表 (${units.size()})"  /}
#{set 'moreScripts'}
    #{script 'Procures/index.coffee'/}
#{/set}

#{if flash.success}
<div class="row-fluid">
    <div class="span12 alert alert-success" style="text-align:center">
        <p>${flash.success.raw()}</p>
    </div>
</div>
#{/if}
#{ifErrors }
    #{errorMsgs /}
#{/ifErrors}

<div class="row-fluid">
    <form action="@{Procures.index()}" method="post">
        <div class="span3 input-prepend">
            <span class="add-on">From:</span>
            <input type="date" style="width:90px;" name="p.from" value="${p.from.date()}">
            <span class="add-on" style="margin-left:20px;">To:</span>
            <input type="date" style="width:90px;" name="p.to" value="${p.to.date()}">
            <select name="p.dateType" style="width:130px;margin-left:20px;">
            #{list items:dateTypes, as:'t'}
                <option ${t._1 == p.dateType ? 'selected' : ''} value="${t._1}">${t._2}</option>
            #{/list}
            </select>
        </div>

        <div class="span3">
            <select name="p.whouseId" class="span4">
                <option value="0">仓库</option>
            #{list items:whouses, as:'wh'}
                <option ${wh.id == p.whouseId ? 'selected' : ''} value="${wh.id}">${wh.name}</option>
            #{/list}
            </select>

            <select name="p.cooperatorId" class="span4">
                <option value="0">供应商</option>
            #{list items:cooperators, as:'cop'}
                <option ${cop.id == p.cooperatorId ? 'selected' : ''} value="${cop.id}">${cop.name}</option>
            #{/list}
            </select>

            <select name="p.stage" class="span4">
                <option value="">阶段</option>
            #{list items:models.procure.ProcureUnit.STAGE.values(), as:'stage'}
                <option ${stage == p.stage ? 'selected' : ''} value="${stage}">${stage}</option>
            #{/list}
            </select>
        </div>

        <div class="span2 input-prepend input-append">
            <span class="add-on"><i class="icon-search"></i></span>
            <input type="text" class="input-medium" name="p.search" value="${p.search}">
            <button class="btn btn-primary">搜索</button>
        </div>
    </form>
</div>

<div class="row-fluid">
    <div class="span12">
        <form method="post" id="create_deliveryment">
        #{render 'Procures/_unit_list.html', units:units, checkbox:true/}
            <input type="hidden" id="name_input" name="name" value="${name}">
        </form>
    </div>
</div>

<div class="row-fluid">
    <div class="span12">
        <div class="input-append">
            <input type="text" id="name_label" placeHolder="采购单的别名(必须)" value="${name}">
            <button id="create_deliveryment_btn" class="btn btn-primary">添加采购单</button>
        </div>
    </div>
</div>