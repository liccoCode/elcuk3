#{extends 'main_full.html' /}
#{set title:"物料出库单列表"  /}
#{set 'moreScripts'}
  #{script 'materialOutbounds/index.es6'/}
#{/set}
<style>
  .table td{
    vertical-align:middle;
  }
</style>
#{errorMsgs /}
#{flash_alert /}

<div class="row-fluid">
  <form action="@{MaterialOutbounds.index()}" method="get" class="search_form" id="search_Form">
    <div class="span12">
      <div class="input-prepend input-append inline">
        <span class="add-on">From:</span>
        <input type="date" name="p.from" value="${p.from.date()}">
        <span class="add-on">To:</span>
        <input type="date" name="p.to" value="${p.to.date()}">
      </div>

      <select name="p.status" class="inline">
        <option value="">状态</option>
      #{list items:models.whouse.Outbound.S, as:'s'}
        <option #{if p.status==s} selected #{/if} value="${s.name()}">${s.label()}</option>
      #{/list}
      </select>

      <select name="p.cooperId" class="inline selectize" style="width:150px;">
        <option value="">供应商</option>
        #{list items:cooperators, as:'cop'}
          <option value="${cop.id}" #{if cop.id==p.cooperId} selected #{/if}>${cop.name}</option>
        #{/list}
      </select>

      <select name="p.type" class="inline">
        <option value="">出库类型</option>
        #{list items:models.material.MaterialOutbound.C, as:'t'}
          <option value="${t.name()}" #{if t==p.type} selected #{/if}>${t.label()}</option>
        #{/list}
      </select>

      <div class="input-prepend input-append inline">
        <span class="add-on"><i class="icon-search"></i></span>
        <input type="text" style="width:200px;" name="p.search" placeholder="物料出库单ID,物料编码" value="${p.search}">
        <input type="hidden" name="p.page" value="${p.page}">
        <button class="btn btn-primary" data-loading>搜索</button>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span12">
        <div class="inline">
          <a href="javascript:void(0)" class="btn btn-primary" id="confirmOutboundBtn">确认出库</a>
          <a target="_blank" href="@{ProcureUnits.exportLogs()}" class="btn btn-info inline">
            <i class="icon-list-alt"></i>导出</a>
        </div>
      </div>
    </div>
  </form>
</div>

<form method="post" id="submit_form" action="@{MaterialOutbounds.confirmMaterialOutbound()}">
  <div class="row-fluid">
    <div class="tab-content">
      <div class="tab-pane fade active in" id='currentPage'>

        <div class="span12">
          <table class="table table-condensed table-bordered" id="data_table">
            <tr>
              <th style="width:15px;">
                <input type="checkbox" id="checkbox_all" class="checkall">
              </th>
              <th width="120px;">出库单ID</th>
              <th>名称</th>
              <th>物料分配项目</th>
              <th width="100px;">出库类型</th>
              <th width="80px;">状态</th>
              <th width="80px;">收货方</th>
              <th width="200px;">目的地</th>
              <th width="80px;">发货人</th>
              <th>创建人</th>
              <th width="120px;">出库日期</th>
              <th width="200px;">备注</th>
            </tr>
          #{list items: materialOutbounds, as: 'o'}
            <tr>
              <td><input type="checkbox" name="ids" value="${o.id}" status="${o.status.name()}"></td>
              <td><a href="@{MaterialOutbounds.edit(o.id)}">${o.id}</a></td>
              <td style="cursor:pointer;" name="clickTd" data-url="@{MaterialOutbounds.showMaterialOutboundUnitList(o.id)}"
                  data-id="${o.id}" data-type="${o.type?.name()}">
                <span><i class="icon-reorder"></i></span>
                <span>${o.name}</span>
                <span class="badge badge-info">${o.units.size()}</span>
              </td>
              <td>${o.projectName}</td>
              <td>${o.type?.label()}</td>
              <td style="background-color:${o.status.rgb()}">${o.status?.label()}</td>
              <td>${o.type?.label()}</td>
              <td title="${o.whouse}">${o.whouse.overLong()}</td>
              <td>${o.consignor}</td>
              <td>${o.creator?.username}</td>
              <td>#{time_tooltip time:o.outboundDate/}</td>
              <td title="${o.memo}">${o.memo.overLong()}</td>
            </tr>
          #{/list}
            <tr>
              <td colspan="14">
              #{if materialOutbounds.size() == 0}
                暂时还没有入库记录
              #{/if}
              #{else }
                  #{bootstrap_pager pi:p, url:'' /}
              #{/else}
              </td>
            </tr>
          </table>
        </div>
      </div>

    </div>
  </div>
</form>

<div id="fba_carton_contents_modal" class="modal hide fade" style="width:1000px;left:40%;">
  <div class="modal-body">
    <div id="refresh_div"></div>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
    <a class="btn btn-primary" id="submitBoxInfoBtn">提交</a>
  </div>
</div>


