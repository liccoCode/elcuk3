#{extends 'main_full.html'/}
#{set title:"物料出货单列表 (${materialPlans.size()})" /}
#{set 'moreScripts'}
  #{script 'materialPlans/index.es6'/}
#{/set}

#{flash_alert /}
#{errorMsgs /}

<!-- 搜索form begin -->
#{form @MaterialPlans.index(), class:'search_form', id:'deliverys_form'}
<div class="row-fluid">
  <div class="span12">
    <div class="input-prepend input-append inline">
      <span class="add-on">From:</span>
      <input type="date" name="p.from" value="${p.from.date()}">
      <span class="add-on">To:</span>
      <input type="date" name="p.to" value="${p.to.date()}">
    </div>


    <select name="p.cooperId" class="inline">
      <option value="">供应商</option>
        #{list items:suppliers, as:'sp'}
          <option ${sp.id == p.cooperId ? 'selected' : ''} value="${sp.id}">${sp.name}</option>
        #{/list}
    </select>

      #{select_enum name: "p.planState", items: models.procure.DeliverPlan.P.values(), value: p.planState,
      class:'inline'}
        <option value="">状态</option>
      #{/select_enum}

    <div class="input-prepend input-append inline">
      <span class="add-on"><i class="icon-search"></i></span>
      <input type="text" name="p.search" class="input-medium" value="${p.search}" placeHolder="物料出货单ID,物料编码">
      <input type="hidden" name="p.page" value="${p.page}">
      <button class="btn btn-primary" data-loading>搜索</button>
    </div>

  </div>
</div>
#{/form}
<!-- 搜索form end -->


<!-- 操作('发给供应商','批量发货','批量签收')form begin -->
<form method="post" id="create_deliveryment">
  <div class="row-fluid">
    <div class="span12">
      <table class="table table-condensed table-bordered" id="data-table">
        <tr>
          <th>全选</th>
          <th>物料出货单ID</th>
          <th>物料请款单ID</th>
          <th>出货单名称</th>
          <th>供应商</th>
          <th>状态</th>
          <th>收货类型</th>
          <th>收货方</th>
          <th>财务审核</th>
          <th>User</th>
          <th>Create</th>
        </tr>
      #{list items:materialPlans, as:'dp'}
        <tr>
          <td>
            <label class="checkbox">
              <input type="checkbox" name="pids" value="${dp.id}" class="${tr_key}" id="checkbox_${dp.id}"
                     data-boxnum="" data-num="" data-lastcartonnum="" data-singleboxweight="" data-length=""
                     data-width="" data-height="">
            </label>
          </td>
          <td>
            <a href="@{MaterialPlans.show(dp.id)}" target="_blank">${dp.id}</a>
          </td>
          <td>

          </td>

          <td style="cursor:pointer;" data-url="@{MaterialPlans.showMaterialPlanUnitList(dp.id)}" data-id="${dp.id}" name="clickTd">
            <span><i class="icon-reorder"></i></span>
            <span>${dp.name}</span>
            <span class="badge badge-info">${dp.units.size()}</span>
          </td>

          <td>${dp.cooperator?.name}</td>
          <td>${dp.state.label()}</td>
          <td>${dp.receipt?.label()}</td>
          <td>${dp.receive}</td>
          <td></td>
          <td>${dp.handler.username}</td>
          <td>#{time_tooltip time:dp.createDate/}</td>
        </tr>
      #{/list}
      </table>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span12">
      <button id="create_deliveryment_btn" class="btn btn-primary" data-disable-with='添加中'>
        发给供应商
      </button>
      <button id="create_deliverplan_btn" class="btn btn-primary" data-disable-with='添加中'>
        财务审核
      </button>
    </div>
  </div>
</form>
<!-- 操作('发给供应商','批量发货','批量签收')form end -->

#{bootstrap_pager pi:p, url:'' /}