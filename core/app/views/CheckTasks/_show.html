#{stylesheet 'bootstrap-datetimepicker.min.css'/}
#{script 'bootstrap-datetimepicker.min.js'/}
#{script 'jquery.filedrop.js' /}
#{script 'component/dropUpload.coffee'/}


<div class="row-fluid">
<div>
#{if ap!=null && ap.id!=null}
       #{info_row title:'流程'}
#{/info_row}
        #{render 'Activitis/_process.html', infos:infos,pdId:ap.processDefinitionId,piId:ap.processInstanceId/}
#{/if}
</div>

#{if issubmit==1}
    #{info_row title:'流程提交信息'}
    #{/info_row}
#{/if}

#{if check == null}
<p class="muted text-center">读取的质检任务不存在!</p>
#{/if}




<div class="row-fluid">
  <form method="POST" id="update_form">
    <table class="table table-bordered ">

    #{if ap!=null && ap.id!=null && issubmit!=null && issubmit==1}

        #{if taskname!=null && taskname=="采购员"}
          <tr>
            <th>处理方式</th>
            <td colspan="4">
                #{select_enum name: 'check.dealway', items: models.qc.CheckTask.DealType.values(), value: check.dealway}
                  <option value="">请选择</option>
                #{/select_enum}
            </td>

            <th>仓库代返工总费用(元)</th>
            <td colspan="4"><input type="text" style="width:100px;" name="check.workfee" class="input-mini"
                                   value="${check.workfee}"></td>

            <th>最新预计交货日期</th>
            <td colspan="4">
              <input type="date" style="width:180px;" name="check.planArrivDate" value="${check.planArrivDate?.date()}">
            </td>
          </tr>

          <tr>
            <th>审核意见</th>
            <td colspan="10">
              <textarea name="check.opition" rows="5" cols="80" class="span12">${check?.opition}</textarea>
              <input type="hidden" name="check.id" value="${check.id}">
            </td>
          </tr>

          <tr>
            <td colspan="12">
              <a id="submitactiviti_btn" href="javascript:void(0)" class="btn btn-info" data-loading>提交流程</a>
              <a id="endactiviti_btn" href="javascript:void(0)" class="btn btn-info" data-loading>复原</a>
            </td>
          </tr>
        #{/if}


      <input type="hidden" name="id" value="${ap.id}">
        #{if taskname!=null && taskname=="质检确认"}
          <tr>
            <th>处理方式</th>
            <td> ${check.dealway.label()}</td>
          </tr>
          <tr>
            <th>审核意见</th>
            <td colspan="10">
              <textarea name="check.opition" rows="5" cols="80" class="span12">${check?.opition}</textarea>
              <input type="hidden" name="check.id" value="${check.id}">
            </td>
          </tr>

            #{if check.dealway==models.qc.CheckTask.DealType.RETURN ||  check.dealway==models.qc.CheckTask.DealType.WAREHOUSE}
              <tr>
                <td colspan="12">
                  <a id="submitactiviti_btn" href="javascript:void(0)" class="btn btn-info" data-loading>提交流程</a>
                </td>
              </tr>
            #{/if}
            #{else}
              <tr>
                <td colspan="12">
                  <a id="updateactiviti_btn" href="javascript:void(0)" class="btn btn-info" data-loading>保存不提交</a>
                  <a id="submitactiviti_btn" href="javascript:void(0)" class="btn btn-info"
                     data-loading>保存并提交流程</a>
                </td>
              </tr>
            #{/else}
        #{/if}

    #{/if}



    #{if taskname!=null && taskname=="运营"}
      <input type="hidden" name="acttype" value="2">
      <input type="hidden" name="check.id" value="${check.id}">
    #{/if}


    #{if taskname==null || taskname!="运营"}
        #{info_row title:'质检信息'}
        #{/info_row}
      <tr>
        <th>FBA</th>
        <td>${check.units?.fba?.shipmentId}</td>
        <th>FnSku</th>
        <td>${check.units.selling?.fnSku}</td>
        <th>质检员</th>
        <td>${check.checkor}</td>
        <th>状态</th>
        <td>${check.checkstat.label()}</td>
      </tr>

      <tr>
        <th>订单数量</th>
        <td>${check.units.attrs.qty}</td>
        <th>实际交货数量</th>
        <td>
          <input type="text" name="check.qty" class="input-mini" value="${check.qty}">
        </td>
        <th>实际抽检数量</th>
        <td><input type="text" name="check.pickqty" class="input-mini" value="${check.pickqty}"></td>
        <th>处理方式</th>
        <td>
            #{select_enum name: 'check.dealway', items: models.qc.CheckTask.DealType.values(), value: check.dealway}
              <option value="">请选择</option>
            #{/select_enum}
        </td>
      </tr>

      <tr>
        <th>质检开始时间</th>
        <td colspan="3">
          <input size="16" type="text" value="${check.startTime?.format("yyyy-MM-dd HH:mm")}" readonly
                 class="form_datetime"
                 name="from">
        </td>
        <th>质检完成时间</th>
        <td colspan="3">
          <input size="16" type="text" value="${check.endTime?.format("yyyy-MM-dd HH:mm")}" readonly
                 class="form_datetime" name="to">
        </td>
      </tr>

      <tr>
        <th>是否合格</th>
        <td colspan="3">
            #{select_enum name: 'check.result', items: models.qc.CheckTask.ResultType.values(), value: check.result/}
        </td>
        <th>是否发货</th>
        <td colspan="3">
          <select name="check.isship" size="1" disabled>
              #{list items:models.qc.CheckTask.ShipType.values(), as: 'shipType'}
                <option value="${shipType}" ${shipType == check.isship? 'selected':''}>${shipType.label()}</option>
              #{/list}
          </select>
        </td>
      </tr>

      <tr>
        <th>备注</th>
        <td colspan="10">
          <textarea name="check.checknote" rows="5" cols="80" class="span12">${check.checknote}</textarea>
          <input type="hidden" name="check.id" value="${check.id}">
        </td>
      </tr>
      <tr>
        <td colspan="6">
            #{if ap==null || ap.id==null}
                #{power.ck "checktasks.update"}
                    #{if check.checkstat != models.qc.CheckTask.StatType.CHECKFINISH}
                      <a id="update_btn" href="javascript:void(0)" class="btn btn-info" data-loading>保存不提交</a>
                      <a id="fullupdate_btn" href="javascript:void(0)" class="btn btn-primary" data-loading>保存并提交</a>
                    #{/if}
                #{/power.ck}
              <a href="@{CheckTasks.checkerList()}" class="btn btn-success" data-loading>取消</a>
            #{/if}
      </tr>
    #{/if}

    </table>
  </form>
</div>

#{if taskname==null || taskname!="运营"}
<div class="row-fluid">
  <div class="span12">
    <h4 class="alert alert-success">凭证<i class="icon-sort-down"></i></h4>
  </div>
</div>
<div class="row-fluid">
  <div style="min-height:300px;" class="span12 well" id="dropbox">
    <ul class="thumbnails uploaded"></ul>
    <div class="message" style="height:150px;padding-top:145px;text-align:center;">Drag & Drop</div>
  </div>
</div>
#{/if}


#{if taskname!=null && taskname=="运营"}

    #{warning_row ''}
    <h4>采购计划在不同状态修改会有限制</h4>
    <ol>
      <li>计划中: 仓库, 合作伙伴, 价格, 数量, 运输类型, 预计到库时间, 预计交货时间, 预计运输时间, 运输单</li>
      <li>采购中: 仓库, 价格, 数量, 运输类型, 预计到库时间, 预计交货时间, 预计运输时间, 运输单</li>
      <li>完成交货: 预计到库时间, 预计交货时间, 预计运输时间, 运输单</li>
    </ol>
    #{/warning_row}

<form action="@{ProcureUnits.updateprocess(unit.id)}" method="post" data-method='PUT' id="unitEditForm">
  <input type="hidden" name="id" value="${unit.id}">
  <table class="table table-condensed table-bordered">
      #{render 'ProcureUnits/_unit_table_trs.html', unit:unit, whouses:whouses /}
    <tr>
      <td colspan="4">
          #{render 'ProcureUnits/_shipments.html'/}
      </td>
    </tr>
    <input type="hidden" name="checkid" value="${check.id}">

    <tr>
      <td colspan="4">
        <input type="hidden" name="oldPlanQty" value="${oldPlanQty}">
        <button type="submit" class="btn btn-primary">更新</button>
        <a id="submitactiviti_btn" href="javascript:void(0)" class="btn btn-info" data-loading>提交流程</a>
      </td>
    </tr>
  </table>
</form>
#{/if}


</div>