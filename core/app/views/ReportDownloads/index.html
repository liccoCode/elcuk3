#{extends 'main_full.html'/}
#{set title:"运营报表下载" /}
#{set 'moreScripts'}
    #{script 'jquery.dataTables.js'/}
    #{script 'ReportDownloads/index.coffee'/}
#{/set}

#{info_row}
<ul>
  <li><strong>[运营报表]</strong>运营报表</li>
</ul>
#{/info_row}
#{flash_alert /}
#{errorMsgs /}

#{form @ReportDownloads.index(), class:'search_form', id:'profits_form'}
<div class="row-fluid">
  <div class="span12">
    <div class="input-prepend input-append inline">
      <span class="add-on">年:</span>
        #{select_year  name: "p.year", value: p.year/}
      <span class="add-on">月:</span>
        #{select_all_month  name: "p.month", value: p.month/}
    </div>

    <div class="inline">
        #{select_enum name:'p.reporttype', items:models.view.post.ReportPost.saleReportTypes(), value:p.reporttype}
          <option value="">报表类型</option>
        #{/select_enum}
    </div>

    <div class="input-prepend input-append inline">
      <span class="add-on"><i class="icon-search"></i></span>
      <button class="btn btn-primary" data-loading>搜索</button>
    </div>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <table id="reports" class="table table-condensed table-bordered">
      <thead>
      <tr>
        <th>序号</th>
        <th>报表类型</th>
        <th>报表名称</th>
        <th>年份</th>
        <th>月份</th>
        <th>生成时间</th>
        <th>下载次数</th>
        <th>操作</th>
      </tr>
      </thead>
      <tbody>
          #{list items:reports, as:'r'}
          <tr>
            <td>${r.id}</td>
            <td>${r.reporttype?r.reporttype.label():''}</td>
            <td>${r.filename}</td>
            <td>${r.year}</td>
            <td>${r.month}</td>
            <td>${r.createAt}</td>
            <td>${r.downloadcount}</td>
            <td><a class="btn btn-primary" href="@{ReportDownloads.download(r.id)}">下载</a>
                #{if r.canBeRecalculated()}
                  <a class="btn btn-primary" id="repeatcalculate" data-url="@{ReportDownloads.repeatCalculate(r.id)}">重新计算</a>
                #{/if}
            </td>
          </tr>
          #{/list}
      </tbody>
    </table>
  </div>
</div>
#{/form}