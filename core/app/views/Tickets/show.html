#{extends 'main.html'/}
#{set title:'Review #' + review.reviewId /}
#{set 'moreScripts'}
    #{script 'tickets/show.coffee'/}
#{/set}

<!-- Review -->
<div class="label label-info">Review</div>
<div>
    <table class="table table-bordered">
        <tr>
            <th>Title</th>
            <td>${review.title}</td>
            <th>UserId</th>
            <td id="userId">${review.userid}</td>
            <th>UserName</th>
            <td>${review.username}</td>
            <th>ReviewDate</th>
            <td>${review.reviewDate.date()}</td>
        </tr>

        <tr>
            <th>isVedio</th>
            <td>${review.isVedio}</td>
            <th>isVineVoise</th>
            <td>${review.isVineVoice}</td>
            <th>isPurchase</th>
            <td>${review.purchased}</td>
            <th>isRealName</th>
            <td>${review.isRealName}</td>
        </tr>

        <tr>
            <th>ReviewId</th>
            <td><a href="${review.reviewLink()}" target="_blank"><span id="reviewId">${review.reviewId}</span></a></td>
            <th>Rating</th>
            <td>${review.rating}</td>
            <th>Listing</th>
            <td>${review.listingId}</td>
            <th>OsTicketId</th>
            <td>${review.osTicketId}</td>
        </tr>

        <tr>
            <th rel="popover" content="稍后补充..."><i class="icon-question-sign"> State</i></th>
            <td>${review.ticket.state}</td>
            <th>isSuccess</th>
            <td>${review.ticket.isSuccess}</td>
            <th>TopN</th>
            <td>${review.topN}</td>
            <th>Click</th>
            <td>${review.helpUp} / ${review.helpClick}</td>
        </tr>
    #{if review.isVedio}
        <tr>
            <td colspan="8">
                <img src="${review.vedioPicUrl}" alt="${review.reviewId}">
            </td>
        </tr>
    #{/if}

        <tr>
            <td colspan="8">
                <div class="row-fluid" id="reason_div">
                    <div class="span5">
                    #{if review.ticket.reasons.size() != 0}
                        #{list items:review.ticket.reasons, as:'ra'}
                            <span class="reason badge badge-important">${ra.reason}</span>
                        #{/list}
                    #{/if}
                    </div>
                    <div class="span7 input-append">
                        <span class="add-on">${cat.categoryId} | ${cat.name}</span>
                    #{list items:unTagReasons, as:'ura'}
                        <span class="unTagReason badge badge-info">${ura.reason}</span>
                    #{/list}
                    </div>
                </div>
            </td>
        </tr>

        <tr>
            <td colspan="8">
                <div class="row-fluid">
                    <div class="span6">

                        <!-- 寻找用户的相关订单 -->
                    #{if review.orderr == null}
                        <button id="try_order" class="btn btn-primary">Try Order</button>
                    #{/if}

                        <!-- 此 Ticket 的处理者 -->
                    #{if review.ticket.resolver == null}
                        <button id="take_it" tid="${review.ticket.id}" rel="popover" content="由我[${session.get("username")}]来处理这个 Ticket" class="btn btn-primary">
                            Take It
                        </button>
                    #{/if}
                    #{else }
                        <span class="badge badge-success">此订单由 ${review.ticket.resolver.username} 处理</span>
                    #{/else}

                        <a class="btn btn-success" href="@{Products.show(review.ticket.sku)}" target="_blank">${review.ticket.sku}</a><br/>
                    </div>

                    <div class="span6">
                        <img src="${review.listing.picUrls}" alt="${review.ticket.sku}">
                    </div>
                </div>
            </td>
        </tr>

        <tr>
            <td colspan="8">
                <h3>Review</h3>
            ${review.review}
            </td>
        </tr>

        <tr>
            <td colspan="8">
                <h3>System Comment</h3>
            ${review.comment}
            </td>
        </tr>
    </table>
</div>

#{if review.orderr != null}
    #{render 'Orders/show.html', ord: review.orderr, part: true/}
#{/if}
