#{extends 'main_full.html'/}
#{set title:'Orders (' + p.count() + ')'/}
#{set 'moreScripts'}
    #{script_cdn name: 'orders/orders.coffee'/}
    #{script_cdn name: 'component/pagination.coffee'/}
#{/set}

<div class="row-fluid">
  <form id="search_form" class="search_form" action="@{Orders.index()}" method="POST">
    <div class="span12">
      <div class="input-prepend inline">
        <span class="add-on">From:</span>
        <input type="date" style="width:100px;" id="p_from" name="p.begin" value="${p.begin?.date()}">
      </div>

      <div class="input-prepend inline">
        <span class="add-on">To:</span>
        <input type="date" style="width:100px;" id="p_to" name="p.end" value="${p.end?.date()}">
      </div>

      <select id="o_market" name="p.market" class="inline">
        <option value="">Market(ALL)</option>
      #{list items:models.market.M.values()}
        <option ${_ == p.market ? 'selected' : ''} value="${_.name()}">${_}</option>
      #{/list}
      </select>
      <select id="o_acc" name="p.accountId" class="inline">
        <option value="">Account</option>
      #{list items:accs}
        <option ${_.id == p.accountId ? 'selected' : ''} value="${_.id}">${_.prettyName()}</option>
      #{/list}
      </select>
      <select id="o_state" name="p.state" class="inline">
        <option value="">State(ALL)</option>
      #{list items:models.market.Orderr.S.values()}
        <option ${_ == p.state ? 'selected' : ''} value="${_.name()}">${_}</option>
      #{/list}
      </select>

      <!-- TODO 暂时不支持排序 -->
    *{<input type="hidden" name="p.orderBy" id="orderBy" value="createDate">}*
    *{<select name="p.desc" class="inline">}*
    *{<option value="DESC">DESC</option>}*
    *{<option value="ASC">ASC</option>}*
    *{</select>}*

    *{<select name="p.paymentInfo" class="inline">}*
    *{<option value="">支付信息</option>}*
    *{<option ${p.paymentInfo == true ? 'selected' : ''} value="true">拥有支付信息</option>}*
    *{<option ${p.paymentInfo == false ? 'selected' : ''} value="false">还没有支付信息}*
    *{</option>}*
    *{</select>}*

    *{<select name="p.warnning" class="inline">}*
    *{<option value="">全部订单</option>}*
    *{<option ${p.warnning == true ? 'selected' : ''} value="true">过滤出警告订单</option>}*
    *{<option ${p.warnning == false ? 'selected' : ''} value="false">正常的订单</option>}*
    *{</select>}*

      <select name="p.promotion" class="inline">
        <option value="">全部订单</option>
        <option value="true"  ${p.promotion == true ? 'selected' : ''}>过滤出促销订单</option>
        <option value="false" ${p.promotion == false ? 'selected' : ''}>不是促销订单</option>
      </select>

      <div class="input-prepend inline">
        <span class="add-on">SKU:</span>
        <input type="text" style="width:160px;" id="inputsku" name="p.sku" placeholder="SKU" autocomplete="off" value="${p.sku}">
      </div>

      <!--
      <div class="input-prepend inline">
        <span class="add-on">PERCENT:</span>
        <input type="text" style="width:40px;" name="p.percent" placeholder="百分比" autocomplete="off" value="${p.percent}">
      </div>}
      -->

      <div class="inline input-append" id="search_btn">
        <input type="hidden" name="p.page" value="${p.page}">
        <!-- TODO  +2 销售数量大于 2 暂时不支持 -->
        <input type="text" style="width:160px;" name="p.search" placeholder="例 *cvd4hs8y6m, 可带 *" value="${p.search}">

        <button class="btn btn-primary" data-loading>搜索</button>
      </div>
    </div>
  </form>
</div>

<div class="row-fluid" id="order_list">
  <div class="span12">
  #{if orders.size() == 0}
    暂时还没有订单
  #{/if}
  #{else }
    <table class="table table-condensed table-bordered">
        #{render 'Orders/_order_table_tr.html', items:orders/}
      <tr class="tb_footer">
        <td colspan="12">
            #{bootstrap_pager pi:p, url:'' /}
        </td>
      </tr>
    </table>
  #{/else}
  </div>
</div>
