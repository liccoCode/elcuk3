#{extends 'main_full.html' /}
#{set title: '运输项目列表' /}
#{set 'moreScripts'}
    #{script 'shipitems/planIndex.coffee'/}
#{/set}
<script type="text/javascript">
  $(document).on('click', '#today', function(e){
    $("input[name='p.from']").data('dateinput').setValue(new Date());
    $("input[name='p.to']").data('dateinput').setValue(new Date());
  });
</script>
#{flash_alert /}

<div class="row-fluid">
  <form action="@{ShipItems.planIndex()}" class="search_form" method="POST">
    <div class="span12">
      <div class="inline">
        <button id="today" class="btn"><i class="icon-search"></i> Today</button>
      </div>
      <div class="input-prepend inline">
        <span class="add-on">From:</span>
        <input type="date" style="width:90px;" name="p.from" value="${p.from.date()}">
      </div>
      <div class="input-prepend inline">
        <span class="add-on" style="margin-left:20px;">To:</span>
        <input type="date" style="width:90px;" name="p.to" value="${p.to.date()}">
      </div>

      <select name="p.dateType" class="inline">
      #{list items:models.view.post.ShipPlanPost.DATE_TYPES, as:'t'}
        <option ${t._1 == p.dateType ? 'selected' : ''} value="${t._1}">${t._2}</option>
      #{/list}
      </select>

      <select name="p.whouseId" class="inline">
        <option value="0">去往仓库</option>
      #{list items:whouses, as:'wh'}
        <option ${wh.id == p.whouseId ? 'selected' : ''} value="${wh.id}">${wh.name}</option>
      #{/list}
      </select>

    #{select 'p.centerId', items: centers, labelProperty: 'centerId', valueProperty: 'centerId', value: p.centerId, style:'width:110px', class:'inline selectize'}
        #{option ''}FBA Center#{/option}
    #{/select}

      <input type="hidden" value="true" name="p.isHaveNoShipment">

      <div class="input-prepend input-append inline">
        <span class="add-on"><i class="icon-search"></i></span>
        <input type="text" class="input-medium" name="p.search" value="${p.search}">
        <button class="btn btn-primary" data-disable-with="搜索中...">搜索</button>
      </div>

      <div class="input-prepend input-append inline">
        <input type="button" id="create_ship_btn" value="创建运输单" class="btn btn-success adjust">
      </div>

    </div>
  </form>
</div>

<div class="row-fluid">
  <form action="@{Shipments.shipPlanToShipment()}" method="POST" id="new_shipment">
    <table class="table table-bordered table-condensed">
      <tr>
        <th><label><input type="checkbox" class="checkall"></label></th>
        <th>出库计划ID</th>
        <th>Selling ID</th>
        <th>SKU</th>
        <th>产品名称</th>
        <th>FBA</th>
        <th>去往仓库</th>
        <th>FBA仓库</th>
        <th>计划出库数</th>
        <th>预计发货时间</th>
        <th>预计到库时间</th>
        <th>运输方式</th>
        <th>报关类型</th>
        <th>箱数</th>
        <th>总重量</th>
        <th>总体积</th>
        <th>创建时间</th>
        <th>创建人</th>
      </tr>
    #{list items: plans, as:'plan'}
      <tr>
        <td><input type="checkbox" name="planIds" value="${plan.id}"></td>
        <td>
          <a href="@{ShipPlans.show(plan.id)}" target="_blank">${plan.id}</a>
        </td>
        <td>${plan.selling?.sellingId}</td>
        <td><a href="@{Products.show(plan.product.sku)}" target="_blank">${plan.product.sku}</a></td>
        <td>${plan.product.abbreviation}</td>
        <td>${plan.fba?.shipmentId}</td>
        <td>${plan.whouse?.name}</td>
        <td>${plan.fba?.fbaCenter?.centerId}</td>
        <td>${plan.planQty}/${plan.qty}</td>
        <td>#{time_tooltip time: plan.planShipDate/}</td>
        <td>#{time_tooltip time: plan.planArrivDate/}</td>
        <td style="color:${plan.shipType?.rgb()}">${plan.shipType?.label()}</td>
        <td>${plan.outboundRecord()?.clearanceType?.label()}</td>
        <td>${plan.totalBoxNum()}</td>
        <td>${plan.totalWeight()}</td>
        <td>${plan.totalVolume()}</td>
        <td>#{time_tooltip time: plan.createDate/}</td>
        <td>${plan.creator.username}</td>
      </tr>
    #{/list}
    </table>
  </form>
</div>

