#{extends 'main_full.html'/}
#{set title:"请款单 ${apply.serialNumber}" /}
#{set 'moreScripts'}
    #{script 'applys/transport.coffee'/}
    #{script 'shipments/paymentunits.coffee'/}
#{/set}
#{flash_alert /}

<div class="row-fluid">
  <div class="span4">
    <form action='@{Applys.transportAddShipment(apply.id)}' class="form-inline" id='addShipment' method="POST">
      <label>运输单 ID
        <input type="text" required="" name='shipmentId' class="input-small">
      </label>
      <button class="btn btn-success preview" data-disable-with='添加中...'>添加运输单</button>
    </form>
  </div>
  <div class="span4">
  ${apply.serialNumber}
  </div>
</div>

<hr style="border-top: 1px dashed;">
<div id='shipments'>
#{list items:apply.shipments, as:'ship'}
  <div class="row-fluid" id="shipment_${ship.id}">
    <div class="span4">
      <div style="max-height:100px">
        <a href="@{Shipments.show(ship.id)}" class="btn btn-success">${ship.id}</a>
        <button data-id='${ship.id}' class="btn btn-small btn-danger delete">
          从当前请款单中剔除
        </button>
      </div>
      <div>
          #{records_ul records: ship.allRecords(), nobr: true /}
      </div>
    </div>
    <div class="span8">
        #{render 'Shipments/_paymentunits.html', ship: ship, feeTypes: feeTypes/}
    </div>
  </div>
  <hr style="border-top: 1px dashed;">
#{/list}
</div>

#{render './_relate_payments.html', payments: apply.payments/}

#{records records: apply.records()/}
