#{extends 'main_full.html'/}
#{set title:"请款单列表" /}
#{set 'moreScripts'}
    #{script 'component/pagination.coffee'/}
#{/set}


#{form @Applys.procures(), class:'search_form', id:'applys_form', method:'POST'}
<div class="row-fluid">
  <div class="span12">
    <div class="input-prepend input-append inline">
      <span class="add-on">From:</span>
      <input type="date" name="p.from" value="${p.from.date()}">
      <span class="add-on">To:</span>
      <input type="date" name="p.to" value="${p.to.date()}">
    </div>

    <div class="inline">
        #{select_enum name:'p.dateType', items:models.view.post.ProcreApplyPost.DateType.values(), value:p.dateType/}

        #{select 'p.supplierId', items:suppliers, labelProperty:'name', valueProperty:'id', value:p.supplierId}
            #{option ''}供应商#{/option}
        #{/select}
    </div>

    <div class="input-prepend input-append inline">
      <span class="add-on"><i class="icon-search"></i></span>
      <input type="hidden" name="p.page" value="${p.page}">
      <input type="text" name="p.search" class="input-medium" value="${p.search}" placeHolder="请款单编号">
      <button class="btn btn-primary" data-loading>搜索</button>
    </div>
  </div>
</div>

<div class="row-fluid">
  <table class="table table-bordered table-condensed">
    <tr>
      <th>#</th>
      <th>请款单编号</th>
      <th>合作伙伴</th>
      <th>已经请款金额</th>
      <th>剩余请款金额</th>
      <th>总需要请款金额</th>
      <th>修正值总额</th>
      <th>最新更新时间</th>
      <th>创建时间</th>
    </tr>

      #{list items:applyes, as:'apply'}
        <tr>
          <td>${apply.id}</td>
          <td><a href="@{Applys.procure(apply.id)}">${apply.serialNumber}</a></td>
          <td>${apply.cooperator.fullName}</td>
            #{set currency:apply.currency()/}
          <td>${currency?.symbol()} ${apply.appliedAmount()}</td>
          <td>${currency?.symbol()} ${apply.leftAmount()}</td>
          <td>${currency?.symbol()} ${apply.totalAmount()}</td>
          <td>${currency?.symbol()} ${apply.fixValueAmount()}</td>
          <td>#{time_tooltip time:apply.updateAt, datetime:true/}</td>
          <td>#{time_tooltip time:apply.createdAt, datetime:true/}</td>
        </tr>
      #{/list}

  </table>
</div>
#{/form}

<div class="row-fluid" id="order_list">
  <div class="span12">
  #{if applyes.size() == 0}
    暂时还没有请款单
  #{/if}
  #{else }
      #{bootstrap_pager pi:p, url:'' /}
  #{/else}
  </div>
</div>