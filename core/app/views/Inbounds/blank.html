#{extends 'main_full.html' /}
#{set title:'采购收货入库单' /}
#{set 'moreScripts'}
    #{script 'inbounds/blank.js'/}
#{/set}
<style>
  .table td{
    vertical-align:middle;
  }
</style>

#{errorMsgs /}
#{flash_alert/}

#{form @Inbounds.create(), method:'POST', id: 'new_inbound'}
    #{info_row title: it.label() + '单'/}
<div class="row-fluid">
  <div class="span12">
    <table class="table table-bordered">
      <tr>
        <th>收货入库单ID</th>
        <td>
          <input type="text" name="inbound.id" disabled>
        </td>
        <th>状态</th>
        <td style="width: 40%;"><input type="text" name="inbound.status" value="Create" readonly></td>
      </tr>
      <tr>
        <th>出货单</th>
        <td><input type="text" name="inbound.plan.id" value="${planId}" readonly></td>
        <th>供应商</th>
        <td>
          <input type="text" value="${proUnit.cooperator.name}" readonly/>
          <input type="hidden" name="inbound.cooperator.id" value="${proUnit.cooperator.id}" id="cooperId">
        </td>
      </tr>
      <tr>
        <th>收货入库单名称</th>
        <td><input type="text" class="span8" name="inbound.name"
                   value="${proUnit.cooperator.name}_${it.label()}_${new Date().date()}_${username}"></td>
        <th>收货类型</th>
        <td>
          <input type="text" value="${it.label()}" readonly>
          <input type="hidden" name="inbound.type" value="${it.name()}">
        </td>
      </tr>
      <tr>
        <th>收货日期<span style="color:red">*</span></th>
        <td><input type="date" name="inbound.receiveDate" required></td>
        <th></th>
        <td></td>
      </tr>
      <tr>
        <th>创建日期</th>
        <td><input type="date" value="${new Date().date()}" readonly="true"></td>
        <th>创建人</th>
        <td><input type="text" value="" readonly="true"></td>
      </tr>
      <tr>
        <th>备注</th>
        <td colspan="4">
          <textarea name="inbound.memo" rows="4" class="input-block-level"></textarea>
        </td>
      </tr>
      <tr>
        <td colspan="4">
          <input type="hidden" name="record.origin" value="">
          <input type="hidden" name="record.state" value="">
          <button class="btn btn-primary" name="create_record">创建</button>
          <a href="@{Inbounds.index()}" class="btn btn-success">取消</a>
        </td>
      </tr>
    </table>
  </div>
</div>
    #{info_row title:'已添加进入【'+it.label()+'单】的【采购单元】'/}
<div class="row-fluid">
  <div class="span12">
    <table class="table table-condensed table-bordered" id="data_table">
      <tr>
        <th><input type="checkbox"></th>
        <th>采购计划ID</th>
        <th>采购单</th>
        <th>Selling</th>
        <th>SKU</th>
        <th>产品名称</th>
        <th>预计交货时间</th>
        <th>预计运输时间</th>
        <th>计划交货数量</th>
        <th>FBA-ShipmentId</th>
        <th>去往仓库</th>
        <th>运输方式</th>
        <th>项目名称</th>
        <th>阶段</th>
      </tr>
        #{list items:units, as:'unit'}
            #{set planQty:it.name()=='Machining'? unit.availableQty : unit.attrs.planQty/}
          <tr class="text-center" id="tr_${unit.id}">
            <td>
              <input type="checkbox" name="dtos[${unit_index-1}].unitId" value="${unit.id}">
              <input type="hidden" name="dtos[${unit_index-1}].unitId" value="${unit.id}">
            </td>
            <td>${unit.id}</td>
            <td>${unit.deliveryment.id}</td>
            <td>${unit.selling?.sellingId}</td>
            <td>${unit.product.sku}</td>
            <td>${unit.product.abbreviation}</td>
            <td>#{time_tooltip time:unit.attrs.planDeliveryDate/}</td>
            <td>#{time_tooltip time:unit.attrs.planShipDate /}</td>
            <td>${planQty}</td>

            <td>${unit.fba?.shipmentId}</td>
            <td>${unit.whouse?.name()}</td>
            <td style="color:${unit.shipType?.rgb()}">${unit.shipType?.label()}</td>
            <td>${unit.projectName}</td>
            <td style="background-color:${unit.stage?.rgb()}">${unit.stage?.label()}</td>
          </tr>
        #{/list}
    </table>
    <div class="input-append">
      <input type="button" class="btn btn-danger" id="deleteBtn" value="解除"/>
    </div>
    <div class="input-append">
      <input type="text" name="msg" value="" placeholder="采购计划ID" id="procureId">
      <input type="button" class="btn btn-warning" rel="tooltip" id="quickAdd" title="输入采购ID，可以快速添加采购计划" value="快速添加">
    </div>

  </div>
</div>

#{/form}

