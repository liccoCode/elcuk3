<table class="table table-condensed table-bordered" id="unit_table">
  <tr>
  #{if !is_check}
    <th>
      <label class="checkbox">
        <input type="checkbox" id="checkbox_all" class="checkall" value="">
      </label>
    </th>
  #{/if}
    <th width="30px;">#</th>
    <th width="40px;">采购计划ID</th>
    <th width="80px;">采购单</th>
  #{if !is_b2b}
    <th width="160px;">Selling</th>
  #{/if}
    <th width="230px;">SKU<br>产品名称</th>
    <th width="140px;">预计交货时间/<br>预计运输时间</th>
    <th style="width:45px;">计划交货数量</th>
    <th style="width:50px;">实际交货数量</th>
    <th width="80px;">交货不足<br>处理方式</th>
    <th width="60px;">包装信息</th>
    <th>FBA-ShipmentId</th>
    <th>去往仓库</th>
    <th width="30px;">运输方式</th>
    <th width="50px;">状态</th>
    <th>质检结果</th>
    <th>合格数</th>
    <th>不良品数</th>
    <th width="80px;">目标仓库</th>
    <th>项目名称</th>
  </tr>
#{list items:units, as:'unit'}
    #{if !is_check}
      <tr id="inboundUnit_${unit.id}">
        <td>
          <input type="checkbox" value="${unit.id}">
          <input type="hidden" name="dtos[${unit_index-1}].id" value="${unit.id}">
        </td>
        <td>${unit.id}</td>
        <td>${unit.unit?.id} </td>
        <td>${unit.unit?.deliveryment?.id}</td>
          #{if !is_b2b}
            <td style="word-break:break-all;">
              <a href="@{Sellings.selling(unit.unit?.selling?.sellingId)}" target="_blank">${unit.unit?.selling?.sellingId}</a>
            </td>
          #{/if}
        <td title="${unit.unit?.product.abbreviation}">
          <a href="@{Products.show(unit.unit?.product?.sku)}" target="_blank">${unit.unit?.product?.sku}</a><br>
          ${unit.unit?.product.abbreviation?.xxLong()}
        </td>
        <td>
          预计交货:#{time_tooltip time:unit.unit?.attrs.planDeliveryDate/}<br>
          预计运输:#{time_tooltip time:unit.unit?.attrs.planShipDate /}
        </td>
        <td>${unit.planQty}</td>
        <td>
          <input type="text" name="qty" autocomplete="off" data-qty="${unit.unit?.attrs.planQty}"
                 style="width:35px;
                     #{if unit.planQty>0 && unit.qty/unit.planQty<0.9 && unit.handType?.name()=='Delivery'}
                         background-color:yellow;
                     #{/if}" value="${unit.qty}" data-origin="${unit.qty}"
              #{if !Arrays.asList('Create','Receive').contains(unit.status.name())}
                 readonly
              #{/if}/>
        </td>
        <td>
          <select name="handType" style="width:75px;
              #{if unit.qty == unit.planQty}
                  display:none;
              #{/if}"
              #{if unit.status.name() != "Create"}
                  disabled
              #{/if}>
              #{list items:models.whouse.InboundUnit.H, as:'h'}
                <option ${h.name() == unit.handType?.name() ? 'selected' : ''}  value="${h.name()}">${h.label()}</option>
              #{/list}
          </select>
        </td>
        <td>
          <input type="button" class="btn btn-success btn-mini" data-id="${unit.id}" name="editBoxInfo" value="填写">
            #{if !unit.validBoxInfoIsComplete()}
              <i class="icon-remove" style="color:red"></i>
            #{/if}
            #{else }
              <i class="icon-ok" style="color:green"></i>
            #{/else}
        </td>
        <td>${unit.unit?.fba?.shipmentId}</td>
        <td>${unit.unit?.whouse?.name()}</td>
        <td style="color:${unit.unit?.shipType?.rgb()}">${unit.unit?.shipType?.label()}</td>
        <td style="background-color:${unit.status.rgb()}">${unit.status?.label()}</td>
        <td>
          <select name="result" style="width:70px;" qty="${unit.qty}"
              #{if unit.status.name() != "Receive"}
                  disabled
              #{/if}>
              #{list items:models.whouse.InboundUnit.R, as:'r'}
                <option ${r.name() == unit.result?.name() ? 'selected' : ''} value="${r.name()}">${r.label()}</option>
              #{/list}
          </select>
        </td>
        <td>
          <input type="text" name="qualifiedQty" data-qty="${unit.qty}" value="${unit.qualifiedQty}" data-origin="${unit.qualifiedQty}"
              #{if unit.status.name()!="Receive" } readonly #{/if}
                 style="width:35px; #{if unit.result?.name() == 'UnCheck'} display:none; #{/if}"/>
        </td>
        <td>
          <input type="text" name="unqualifiedQty" data-qty="${unit.qty}" data-origin="${unit.unqualifiedQty}"
                 value="${unit.unqualifiedQty}"
              #{if unit.status.name()!="Receive" } readonly #{/if}
                 style="width:35px; #{if unit.result?.name() == 'UnCheck'} display:none; #{/if}"/>
        </td>
        <td>
          <select name="target" style="max-width: 80px;" ${unit.status.name() != "Receive" ? 'disabled':''}>
            <option value="">仓库</option>
              #{list items:whouses, as:'whouse'}
                <option ${whouse.id == unit.target?.id ? 'selected' : ''} value="${whouse.id}">
                ${whouse.name}
                </option>
              #{/list}
          </select>
        </td>
        <td>${unit.unit.projectName}</td>
      </tr>
    #{/if}
    #{else }
      <tr class="text-center">
        <td>${unit.id}</td>
        <td>
          <a href="@{Deliveryments.show(unit.unit?.deliveryment?.id)}#${unit.unit?.id}" target="_blank">${unit.unit?.id}</a>
        </td>
        <td>
          <a href="@{Deliveryments.show(unit.unit?.deliveryment?.id)}" target="_blank">${unit.unit?.deliveryment?.id}</a>
        </td>
        <td>${unit.unit?.selling?.sellingId}</td>
        <td title="${unit.unit?.product?.abbreviation}">
          <a href="@{Products.show(unit.unit?.product?.sku)}" target="_blank">${unit.unit?.product?.sku}</a><br>
        ${unit.unit?.product?.abbreviation.xxLong()}
        </td>
        <td>
          预计交货:#{time_tooltip time:unit.unit?.attrs?.planDeliveryDate/}<br>
          预计运输:#{time_tooltip time:unit.unit?.attrs?.planShipDate /}
        </td>
        <td>${unit.planQty}</td>
        <td>${unit.qty}</td>
        <td>#{if unit.qty != unit.planQty}${unit.handType?.label()}#{/if}</td>
        <td>
          <input type="button" class="btn btn-success btn-mini" data-id="${unit.id}" name="editBoxInfo" value="查看">
            #{if !unit.validBoxInfoIsComplete()}
              <i class="icon-remove" style="color:red"></i>
            #{/if}
            #{else }
              <i class="icon-ok" style="color:green"></i>
            #{/else}
        </td>
        <td>${unit.unit?.fba?.shipmentId}</td>
        <td>${unit.unit?.whouse?.name}</td>
        <td style="color:${unit.unit?.shipType?.rgb()}">${unit.unit?.shipType?.label()}</td>
        <td style="background-color:${unit.status.rgb()}">${unit.status?.label()}</td>
        <td>
            #{if unit.result?.name()=='Qualified'}
              <i style="color:green" class="icon-ok"></i>
            #{/if}
            #{elseif unit.result?.name()=='Unqualified'}
              <i style="color:red" class="icon-remove"></i>
            #{/elseif}
        </td>
        <td>${unit.qualifiedQty}</td>
        <td>${unit.unqualifiedQty}</td>
        <td>${unit.target?.name}</td>
        <td>${unit.unit?.projectName}</td>
      </tr>
    #{/else}
#{/list}
</table>