<table class="table table-condensed table-bordered" id="unit_table">
  <tr>
    <th><input type="checkbox"></th>
    <th style="width:40px;">记录ID</th>
    <th style="width:40px;">采购计划ID</th>
    <th>采购单</th>
    <th style="width:120px;">Selling</th>
    <th>SKU</th>
    <th style="width:100px;">产品名称</th>
    <th>预计交货时间</th>
    <th>预计运输时间</th>
    <th style="width:45px;">计划交货数量</th>
    <th style="width:50px;">实际交货数量</th>
    <th>交货不足处理方式</th>
    <th>包装信息</th>
    <th>FBA-ShipmentId</th>
    <th>去往仓库</th>
    <th>运输方式</th>
    <th>阶段</th>
    <th>质检结果</th>
      #{if !is_check}
      <th>质检不合格
      处理方式</th>
      #{/if}
    <th>合格数</th>
    <th>不良品数</th>
    <th>实际入库数</th>
    <th>目标仓库</th>
  </tr>
#{list items:units, as:'unit'}
    #{if !is_check}
      <tr class="text-center">
        <td>
          <input type="checkbox" value="${unit.id}">
          <input type="hidden" name="dtos[${unit_index-1}].id" value="${unit.id}">
        </td>
        <td>${unit.id}</td>
        <td>${unit.unit?.id}</td>
        <td>${unit.unit?.deliveryment.id}</td>
        <td>${unit.unit?.selling?.sellingId}</td>
        <td>${unit.unit?.product.sku}</td>
        <td title="${unit.unit?.product.abbreviation}">${unit.unit?.product.abbreviation.overLong()}</td>
        <td>#{time_tooltip time:unit.unit?.attrs.planDeliveryDate/}</td>
        <td>#{time_tooltip time:unit.unit?.attrs.planShipDate /}</td>
        <td>${unit.planQty}</td>
        <td>
          <input type="text" name="qty" autocomplete="off" data-qty="${unit.unit?.qty()}"
                 style="width:35px;" value="${unit.qty}"
              #{if unit.status.name() != "Create"}
                 readonly
              #{/if}/>
        </td>
        <td>
          <select name="handType" style="width:120px;
              #{if unit.qty == unit.planQty}
                  display:none;
              #{/if}"
              #{if unit.status.name() != "Create"}
                  disabled
              #{/if}>
              #{list items:models.whouse.InboundUnit.H, as:'h'}
                <option ${h.name() == unit.handType?.name() ? 'selected' : ''}  value="${h.name()}">${h.label()}</option>
              #{/list}
          </select>
        </td>
        <td>
          <input type="button" class="btn btn-mini btn-success" data-id="${unit.id}" name="editBoxInfo" value="填写">
        </td>
        <td>${unit.fba?.shipmentId}</td>
        <td>${unit.unit?.whouse?.name()}</td>
        <td style="color:${unit.unit?.shipType?.rgb()}">${unit.unit?.shipType?.label()}</td>
        <td style="background-color:${unit.status.rgb()}">${unit.status?.label()}</td>
        <td>
          <select name="result" style="width:60px;"
              #{if unit.status.name() != "Receive"}
                  disabled
              #{/if}>
              #{list items:models.whouse.InboundUnit.R, as:'r'}
                <option ${r.name() == unit.result?.name() ? 'selected' : ''} value="${r.name()}">${r.label()}</option>
              #{/list}
          </select>
        </td>
        <td>
          <select name="way" style="width:120px;
              #{if unit.result?.name() == 'Qualified'}
                  display:none;
              #{/if}"
              #{if unit.status.name() != "Receive"}
                  disabled
              #{/if}>
              #{if unit.inbound.type.name()=='Machining'}
                <option value="PTRework">品拓返工</option>
              #{/if}
              #{else }
                  #{list items:models.whouse.InboundUnit.W, as:'w'}
                    <option ${w.name() == unit.way?.name() ? 'selected' : ''} value="${w.name()}">${w.label()}</option>
                  #{/list}
              #{/else}
          </select>
        </td>
        <td>
          <input type="text" name="qualifiedQty" data-qty="${unit.qty}" value="${unit.qualifiedQty}"
              #{if unit.status.name() != "Receive"}
                 disabled
              #{/if} style="width:35px;"/>
        </td>
        <td>
          <input type="text" name="unqualifiedQty" data-qty="${unit.qty}" value="${unit.unqualifiedQty}" style="width:35px;"
              #{if unit.status.name() != "Receive"}
                 disabled
              #{/if}/>
        </td>
        <td>
          <input type="text" name="inboundQty" value="${unit.inboundQty}" style="width:35px;"
              #{if unit.status.name() != "Check"}
                 disabled
              #{/if}/>
        </td>
        <td>
          <select name="target" style="max-width: 100px;"
              #{if unit.status.name() != "Check"}
                  disabled
              #{/if}>
            <option value="">仓库</option>
              #{list items:whouses, as:'whouse'}
                <option ${whouse.id == unit.target?.id ? 'selected' : ''} value="${whouse.id}">
                ${whouse.name}
                </option>
              #{/list}
          </select>
        </td>
      </tr>
    #{/if}
    #{else }
      <tr class="text-center">
        <td>
          <input type="checkbox" value="${unit.id}">
          <input type="hidden" name="dtos[${unit_index-1}].id" value="${unit.id}">
        </td>
        <td>${unit.id}</td>
        <td>${unit.unit?.id}</td>
        <td>${unit.unit?.deliveryment?.id}</td>
        <td>${unit.unit?.selling?.sellingId}</td>
        <td>${unit.unit?.product?.sku}</td>
        <td title="${unit.unit?.product?.abbreviation}">${unit.unit?.product?.abbreviation.overLong()}</td>
        <td>#{time_tooltip time:unit.unit?.attrs?.planDeliveryDate/}</td>
        <td>#{time_tooltip time:unit.unit?.attrs?.planShipDate /}</td>
        <td>${unit.planQty}</td>
        <td>${unit.qty}</td>
        <td>#{if unit.qty != unit.planQty}${unit.handType?.label()}#{/if}</td>
        <td>
          <input type="button" class="btn btn-mini btn-success" data-id="${unit.id}" name="editBoxInfo" value="查看">
        </td>
        <td>${unit.fba?.shipmentId}</td>
        <td>${unit.unit?.whouse?.name()}</td>
        <td style="color:${unit.unit?.shipType?.rgb()}">${unit.unit?.shipType?.label()}</td>
        <td style="background-color:${unit.status.rgb()}">${unit.status?.label()}</td>
        <td>
            #{if unit.result?.name()=='Qualified'}
              <i style="color:green" class="icon-ok"></i>
            #{/if}
            #{elseif unit.result?.name()=='Unqualified'}
              <i style="color:red" class="icon-remove">${unit.way?.label()}</i>
            #{/elseif}
        </td>
        <td>${unit.qualifiedQty}</td>
        <td>${unit.unqualifiedQty}</td>
        <td>${unit.inboundQty}</td>
        <td>${unit.target?.name}</td>
      </tr>
    #{/else}
#{/list}
</table>