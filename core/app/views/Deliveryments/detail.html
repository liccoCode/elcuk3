#{extends 'main_full.html' /}
#{set title:dlmt.id /}
#{set 'moreScripts'}
    #{script 'jquery.filedrop.js' /}
    #{script 'jquery.validate.min.js'/}
    #{script 'component/dropUpload.coffee'/}
    #{script 'deliveryments/detail.coffee'/}
#{/set}

<div><span class="label label-info">基础信息</span></div>
<div>
    <table class="table table-condensed table-bordered">
        <tr>
            <td>Id:</td>
            <td id="deliveryId">${dlmt.id}</td>
            <td>State:</td>
            <td style="background:${dlmt.state.color()}">${dlmt.state}</td>
            <td>创建日期</td>
            <td>${dlmt.createDate.format("yyyy-MM-dd hh:mm:ss")}</td>
            <td>User:</td>
            <td>${dlmt.handler.username}</td>
            <td>&nbsp;</td>
            <td class="pull-right">
            #{ck 'root'}
                <button id="cancel_btn" rel="popover" data-content="取消这个 Delivery, 其关联的 ProcureUnit 与 ShipItem 的数量全部变为 0;" placement='left' class="btn btn-small btn-danger">
                    CANCEL
                </button>
            #{/ck}
            </td>
        </tr>

        <tr>
            <td>
                <button id="add_memo" rel="popover" data-content="保存更新 Memo" width="auto" class="btn btn-small btn-primary">
                    Memo
                </button>
            </td>
            <td colspan="9">
                <textarea rows="5" class="span11">${dlmt.memo}</textarea>
            </td>
        </tr>
    </table>
</div>

<div><span class="label label-info">付款信息</span></div>
<div>
#{payment_listPayment items:dlmt.payments /}
#{if !dlmt.isPaymentComplete()}
    #{payment_addPayment type:'DELIVERY', payObjId:dlmt.id /}
#{/if}
</div>

<div>
    <span class="label label-info">ProcureUnits</span>
    <button dlmtId='${dlmt.id}' rel="popover" content="重新刷新 Table" placement="right" class="btn btn-warning btn-mini">
        <i class="icon-refresh"></i></button>
</div>
<div id="procure_units">
#{render 'Deliveryments/ajaxProcureUnitTable.html', dlmt:dlmt/}
</div>

<div><span style="line-break:strict;" class="label label-info">附件</span></div>
<div style="min-height:300px;background:#eee;" id="dropbox">
    <ul class="thumbnails uploaded"></ul>
    <div class="message" style="height:150px;padding-top:145px;text-align:center;">Drag & Drop</div>
</div>
