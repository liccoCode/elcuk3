#{extends 'main_full_v3.html'/}
#{set title:"采购单 #" + dmt.id /}
#{set 'moreScripts'}
    #{script 'jquery.filedrop.js'/}
    #{script 'component/dropUpload.coffee'/}
    #{script 'timeline/timeline_js/timeline-api.js'/}
    #{script 'analyzes/timeline.coffee'/}
    #{script 'deliveryments/show.coffee'/}
    #{script 'procureunits/_unit_list.coffee'/}
    #{script 'deliveryments/fba_carton_contents.coffee'/}
#{/set}

#{errorMsgs /}
#{flash_alert /}

#{set isPending: Arrays.asList('PENDING','APPROVE','REJECT').contains(dmt.state.name()) /}

<div class="row">
  <div class="col-md-12">
    <div class="box box-primary box-solid">
      <div class="box-header with-border"><h3 class="box-title">采购单信息</h3></div>
      <form action="@{Deliveryments.update()}" method="post" name="updateDeliverymentForm" id="updateDeliverymentForm"
            class="form-horizontal">
        <div class="box-body">
          <div class="form-group">
            <label for="p_sku" class="col-sm-1 control-label">ID</label>
            <div class="col-sm-2">
              <input class="form-control" value="${dmt.id}" id="deliverymentId" name="dmt.id" readonly/>
              <input type="hidden" value="${paymentId}" id="paymentId">
            </div>
            <label for="subtitle_input" class="col-sm-1 control-label">State</label>
            <div class="col-sm-2">
              <input type="text" readonly class="form-control" value="${dmt.state.label()}
                          #{if dmt.state.name().equals("PENDING_REVIEW")}(${applyMsg?.split(",")[0]})#{/if}">
            </div>
            <label for="subtitle_input" class="col-sm-1 control-label">CreateDate</label>
            <div class="col-sm-2">
              <input type="text" readonly class="form-control" name="dmt.createDate" value="${dmt.createDate.datetime()}">
            </div>
          </div>

          <div class="form-group">
            <label for="p_sku" class="col-sm-1 control-label">Name</label>
            <div class="col-sm-5">
              <input type="text" class="form-control" name="dmt.name" value="${dmt.name}">
            </div>
            <label for="p_sku" class="col-sm-1 control-label">总额</label>
            <div class="col-sm-2">
              <input type="text" class="form-control" value="${total.format('#,###.##')}" readonly>
            </div>
            <label for="p_sku" class="col-sm-1 control-label">Creator</label>
            <div class="col-sm-2">
              <input type="text" class="form-control" value="${dmt.handler.username}" readonly>
            </div>
          </div>

          <div class="form-group">
            <label for="p_sku" class="col-sm-1 control-label">下单时间</label>
            <div class="col-sm-2">
              <input role="date" class="form-control" name="dmt.orderTime" value="${dmt.orderTime?.date()}">
            </div>
            <label for="p_sku" class="col-sm-1 control-label">交货时间</label>
            <div class="col-sm-2">
              <input role="date" class="form-control" name="dmt.deliveryTime" value="${dmt.deliveryTime?.date()}">
            </div>
            <label for="p_sku" class="col-sm-1 control-label">供应商</label>
            <div class="col-sm-2">
              <input type="text" class="form-control" value="${dmt.cooperator?.name}" readonly>
            </div>
          </div>

          <div class="form-group">
            <label for="p_sku" class="col-sm-1 control-label">Memo</label>
            <div class="col-sm-11">
              <textarea rows="5" name="dmt.memo" class="form-control">${dmt.memo}</textarea>
            </div>
          </div>
        </div>
        <div class="box-footer">
        #{power.ck "products.edit"}
          <button class="btn btn-primary">更新</button>
        #{/power.ck}
        </div>
      </form>
    </div>

    <div class="form-inline">
    #{if isPending}
      <form action="@{Deliveryments.confirm()}" method="post" style="display:inline-block;" id="confirmForm">
        <div class="input-prepend input-append" style="float:left;">
          <span class="add-on" rel="popover" content="确认采购单, 采购单进行确认以后, 才可以在运输单中进行挑选, 并且不再允许添加新的采购计划" placement="right"><i class="icon-question-sign"></i></span>
          <input type="hidden" name="id" value="${dmt.id}">
            #{power.ck "products.edit"}
              <input type="button" class="btn btn-primary" id="confirmBtn" value="确认">
            #{/power.ck}
        </div>
      </form>
    #{/if}
    #{power.ck 'deliveryments.cancel'}
      <form action="@{Deliveryments.cancel()}" method="post" style="display:inline-block;" class="form-inline">
        <input type="hidden" name="id" value="${dmt.id}">
        <div class="input-append" style="float:left;margin-left:10px;">
          <input type="text" name="msg" value="${msg}" placeHolder="简要填写关闭的原因" class="form-control">
          <button class="btn btn-danger">取消采购单</button>
        </div>
      </form>
    #{/power.ck}

    #{power.ck 'deliveryments.review'}
        #{if dmt.state.name().equals("PENDING_REVIEW")}
          <form action="@{Deliveryments.review()}" method="post" style="display:inline-block;">
            <input type="hidden" name="id" value="${dmt.id}">
            <div class="input-append" style="float:left;margin-left:10px;">
              <select style="width:80px;" name="result">
                <option value="">请选择</option>
                <option value="true">通过</option>
                <option value="false">驳回</option>
              </select>
              <input type="text" name="msg" value="${msg}" id="apply_input" style="display:none;"
                     placeHolder="如果驳回，简要填写驳回的原因">
              <button class="btn btn-warning">提交审核</button>
            </div>
          </form>
        #{/if}
    #{/power.ck}
    #{if dmt.apply}
      <div style="float:left;display:inline-block">
        <a href="@{Applys.procure(dmt.apply.id)}" class="btn btn-success">${dmt.apply.serialNumber}
          请款单</a>
      </div>
    #{/if}
    </div>

    <div class="box box-warning box-solid">
      <div class="box-header"><h3 class="box-title" data-toggle="toggle" data-target="#tl">Timeline
        <i class="icon-reorder"></i></h3></div>
      <div class="box-body">
        <div id="tl" class="col-sm-12" style="height:350px;"></div>
      </div>
    </div>

    <div class="box box-success box-solid">
      <div class="box-header"><h3 class="box-title">已经添加进入[采购单]的[采购单元]</h3></div>
      <div class="box-body" id="unit_list">
      #{if isB2B}
          #{render 'ProcureUnits/_b2b_unit_list.html', units:dmt.units, checkbox:true, key:'delivery', delivery:true/}
      #{/if}
      #{else }
          #{render 'ProcureUnits/_unit_list_v3.html', units:dmt.units, checkbox:true, key:'delivery', delivery:true,paymentId:paymentId/}
      #{/else}
      </div>
      <div class="box-footer">
      #{power.ck "products.edit"}
        <a href="javascript:void(0);" data-url='@{Deliveryments.delunits(dmt.id)}' data-method="DELETE"
           id="delunit_form_submit" rel="popover" content="将 DELIVERY 状态的采购计划从采购单中移除出去" placement="right" class="btn btn-warning">
          解除
        </a>
      #{/power.ck}
      #{power.ck 'fbas.deploytoamazon'}
        <a href="javascript:void(0);" data-url='@{FBAs.deploysToAmazon("Deliveryments", dmt.id)}' data-method="POST"
           id="deployFBAs" class="btn btn-success">
          批量创建FBA</a>
        <a href="javascript:void(0);" data-url='@{FBAs.updateCartonContents("Deliveryments", dmt.id)}' data-method="POST"
           id="updateFbaCartonContents" class="btn btn-success">
          批量更新FBA箱内包装信息</a>
      #{/power.ck}
      #{power.ck 'fbas.procureunitsorder'}
        <a href="javascript:void(0);" data-url="@{Excels.procureunitsOrder(dmt.id)}" data-method="POST"
           id="downloadProcureunitsOrder" class="btn btn-success" rel="popover" content="下载选定的采购单元的出货单">
          <i class="icon-download-alt"></i>下载出货单
        </a>
      #{/power.ck}
        <a href="javascript:void(0);" data-url="@{FBAs.downloadZip("Deliveryments", dmt.id)}" data-method="POST"
           id="downloadFBAZIP" class="btn btn-info" rel="popover" content="将选定的采购单元的 出货FBA进行压缩打包">
          <i class="icon-download-alt"></i>下载FBA ZIP 包
        </a>
        <input id='form_method' type="hidden" name="x-http-method-override" value="POST">
      </div>
    </div>

    <div class="box box-warning box-solid collapsed-box">
      <div class="box-header"><h3 class="box-title">生成采购单信息 <i class="icon-reorder" data-widget="collapse"></i></h3>
      </div>
      <form id="generate_excel" method="post" action="@{Excels.deliveryment()}" class="form-horizontal">

        <div class="box-body">
          <div class="form-group">
            <label for="excel_deliveryAddress" class="col-sm-1 control-label">交货地址</label>
            <div class="col-sm-11">
              <textarea rows="6" class="form-control" name="excel.deliveryAddress" id="excel_deliveryAddress">
                          收货时间：法定工作日 8:30-12:00  13:30-18:00，工作日其他时间到货请提前 1 小时联系。
                          仓库地址：深圳市光明新区玉律村汉海达科技创新园 1 栋 A 区 6 楼
                          电   话：0755-21383192-8060/8061
                          收货联系人：
                                  Jie：  18692275630
                                  杨上德：13724219110
              </textarea>
            </div>
          </div>

          <div class="form-group">
            <label for="excel_tradeTerms" class="col-sm-1 control-label">交易条款<br>(供应商)</label>
            <div class="col-sm-5">
              <textarea rows="10" name="excel.tradeTerms" id="excel_tradeTerms" class="form-control">${dmt.cooperator.tradingTerms}</textarea>
            </div>
            <label for="excel_deliveryAddress" class="col-sm-1 control-label">产品要求<br>(产品线)</label>
            <div class="col-sm-5">
            #{list items:dmt.getCopperItems(), as:'cooperItem'}
              <a href="@{Cooperators.editCooperItem(cooperItem.id)}" target="_blank" class="btn btn-xs btn-info"
                 data-toggle="popover" data-content="${cooperItem.formatProductTerms()}">
              ${cooperItem.product.sku}
              </a>
            #{/list}
            </div>
          </div>

          <div class="form-group">
            <label for="" class="col-sm-6 control-label" style="text-align:center;">供货方信息</label>
            <label for="" class="col-sm-6 control-label" style="text-align:center;">买方信息</label>
          </div>

          <div class="form-group">
            <label for="excel_supplierCompany" class="col-sm-1 control-label">供方</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.supplierCompany" id="excel_supplierCompany" value="${dmt.cooperator.fullName}">
            </div>
            <label for="excel_supplier" class="col-sm-1 control-label">经办人</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.supplier" id="excel_supplier" value="${dmt.cooperator.contacter}">
            </div>

            <label for="excel_buyerCompany" class="col-sm-1 control-label">买方</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.buyerCompany" id="excel_buyerCompany"
                     value="${isB2b ? models.OperatorConfig.getVal("b2bbuyercompany"):models.OperatorConfig.getVal("buyercompany")}">
            </div>
            <label for="excel_tradeTerms" class="col-sm-1 control-label">经办人</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.buyer" id="excel_buyer" value="${dmt.handler?.username}">
            </div>
          </div>

          <div class="form-group">
            <label for="excel_supplierPhone" class="col-sm-1 control-label">移动电话</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.supplierPhone" id="excel_supplierPhone" value="${dmt.cooperator.phone}">
            </div>
            <label for="excel_supplierTel" class="col-sm-1 control-label">固定电话</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.supplierTel" id="excel_supplierTel" value="${dmt.cooperator.tel}">
            </div>

            <label for="excel_buyerPhone" class="col-sm-1 control-label">移动电话</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.buyerPhone" id="excel_buyerPhone" value="${dmt.handler?.phone}">
            </div>
            <label for="excel_buyerTel" class="col-sm-1 control-label">固定电话</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.buyerTel" id="excel_buyerTel" value="${isB2b ? '' : models.OperatorConfig.getVal("buyertel")}">
            </div>
          </div>

          <div class="form-group">
            <label for="excel_supplierFax" class="col-sm-1 control-label">传真</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.supplierFax" id="excel_supplierFax" value="${dmt.cooperator.fax}">
            </div>
            <label for="excel_supplierTel" class="col-sm-1 control-label"></label>
            <div class="col-sm-2"></div>

            <label for="excel_buyerFax" class="col-sm-1 control-label">传真</label>
            <div class="col-sm-2">
              <input class="form-control" name="excel.buyerFax" id="excel_buyerPhone">
            </div>
            <label for="chosebuyer" class="col-sm-1 control-label">选择经办人</label>
            <div class="col-sm-2">
              <select id="chosebuyer" class="form-control">
                <option value="">请选择</option>
              #{list items:buyers, as:'br'}
                  #{ifnot br.username == 'wyatt'}
                    <option value="${br.id}">${br.username}</option>
                  #{/ifnot}
              #{/list}
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="excel_supplierAddress" class="col-sm-1 control-label">地址</label>
            <div class="col-sm-5">
              <input class="form-control" name="excel.supplierAddress" id="excel_supplierAddress" value="${dmt.cooperator.address}">
            </div>
            <label for="excel_buyerAddress" class="col-sm-1 control-label">地址</label>
            <div class="col-sm-5">
              <input class="form-control" name="excel.buyerAddress" id="excel_buyerAddress"
                     value="${isB2b ? models.OperatorConfig.getVal("b2bbuyeraddress") :models.OperatorConfig.getVal("buyeraddress")}">
            </div>
          </div>
        </div>
        <div class="box-footer">
          <input type="hidden" name="id" value="${dmt.id}">
          <input type="button" id="generate_excel_btn" class="btn btn-success" value="生成采购单 Excel">
        </div>
      </form>
    </div>




  #{if Arrays.asList('PENDING','CONFIRM').contains(dmt.state.name())}
    <div class="box box-info box-solid">
      <div class="box-header"><h3 class="box-title">可添加进入[采购单]的[采购单元]</h3></div>
      <form action="@{Deliveryments.addunits(dmt.id)}" method="post" class="form-inline">
        <div class="box-body">
            #{if isB2B}
                #{render 'ProcureUnits/_b2b_unit_list.html', units:plan_units, checkbox:true, key:'plan'/}
            #{/if}
            #{else }
            #{render 'ProcureUnits/_unit_list.html', units:plan_units, checkbox:true, key:'plan'/}
        #{/else}
        </div>
        <div class="box-footer">
          <div class="pull-left input-prepend input-append">
            <span class="add-on" rel="popover" content="将 PLAN 状态的采购计划添加到采购单中" placement="right"><i class="icon-question-sign"></i></span>
              #{power.ck "products.edit"}
                <button id="plan_form_submit" class="btn btn-primary">添加</button>
              #{/power.ck}
          </div>
        </div>
      </form>
    </div>
  #{/if}


    <div class="row-fluid">
      <div class="span12">
        <h4 class="alert alert-success">附件 <i class="icon-sort-down"></i></h4>
      </div>
    </div>
    <div class="row-fluid">
      <div style="min-height:300px;" class="col-sm-12 well" id="delivery_plan_dropbox">
        <ul class="thumbnails uploaded"></ul>
      #{power.ck "products.edit"}
        <div class="message" style="height:150px;padding-top:145px;text-align:center;">Drag & Drop</div>
      #{/power.ck}
      </div>
    </div>

  #{records_v3 records:records/}

  </div>
</div>


<div class="row-fluid">
#{if dmt.state.name().equals("PENDING_REVIEW")}
  <ul class="nav nav-tabs">
    <li class="active" id="below_tab">
      <a href="#currentPage" data-toggle='tab'>待审采购单</a>
    </li>
    <li>
      <a href="#relateDelivery" data-toggle='tab'>相关采购单</a>
    </li>
  </ul>
#{/if}
  <div class="tab-content">
    <div class="tab-pane fade active in" id='currentPage'>
      <form action="@{Deliveryments.update()}" method="post" name="updateDeliverymentForm" id="updateDeliverymentForm">
        <table class="table table-condensed table-bordered">
          <tr>
            <th width="120px;">Id</th>
            <td>
              <span id="deliverymentId">${dmt.id}</span>
              <input type="hidden" name="dmt.id" value="${dmt.id}">

            </td>

            <th>State</th>
            <td style="color:${dmt.state.rgb()}" width="400px;">
            ${dmt.state.label()}
            #{if dmt.state.name().equals("PENDING_REVIEW")}
              (${applyMsg?.split(",")[0]})
            #{/if}
            </td>
            <th>CreateDate</th>
            <td>
              <input type="text" readonly="" disabled="" class="input-medium" name="dmt.createDate" value="${dmt.createDate.datetime()}">
            </td>
          </tr>

          <tr>
            <th>Name</th>
            <td colspan="2">
              <input type="text" class="span10" name="dmt.name" value="${dmt.name}">
            </td>
            <td>总额￥ ${total.format('#,###.##')}</td>
            <th>User</th>
            <td>${dmt.handler.username}</td>
          </tr>
          <tr>
            <th>供应商</th>
            <td>${dmt.cooperator?.name}</td>
            <th>下单时间</th>
            <td>
              <input type="date" name="dmt.orderTime" value="${dmt.orderTime?.date()}">
            </td>
            <th>交货时间</th>
            <td>
              <input type="date" name="dmt.deliveryTime" value="${dmt.deliveryTime?.date()}">
            </td>
          </tr>

          <tr>
            <th><h4>Memo:</h4></th>
            <td colspan="5">
              <textarea rows="5" name="dmt.memo" class="span12">${dmt.memo}</textarea>
            </td>
          </tr>
        #{power.ck "products.edit"}
          <tr>
            <td colspan="6">
              <button class="btn btn-primary">更新</button>
            </td>
          </tr>
        #{/power.ck}
        </table>
      </form>
    </div>

    <div class="tab-pane fade" id='relateDelivery'>
    #{include 'Deliveryments/_relate_index.html'/}
    </div>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
  #{if isPending}
    <form action="@{Deliveryments.confirm()}" method="post" style="display:inline-block;" id="confirmForm">
      <div class="input-prepend input-append" style="float:left;">
        <span class="add-on" rel="popover" content="确认采购单, 采购单进行确认以后, 才可以在运输单中进行挑选, 并且不再允许添加新的采购计划" placement="right"><i class="icon-question-sign"></i></span>
        <input type="hidden" name="id" value="${dmt.id}">
          #{power.ck "products.edit"}
            <input type="button" class="btn btn-primary" id="confirmBtn" value="确认">
          #{/power.ck}
      </div>
    </form>
  #{/if}
  #{power.ck 'deliveryments.cancel'}
    <form action="@{Deliveryments.cancel()}" method="post" style="display:inline-block;">
      <input type="hidden" name="id" value="${dmt.id}">
      <div class="input-append" style="float:left;margin-left:10px;">
        <input type="text" name="msg" value="${msg}" placeHolder="简要填写关闭的原因">
        <button class="btn btn-danger">取消采购单</button>
      </div>
    </form>
  #{/power.ck}

  #{power.ck 'deliveryments.review'}
      #{if dmt.state.name().equals("PENDING_REVIEW")}
        <form action="@{Deliveryments.review()}" method="post" style="display:inline-block;">
          <input type="hidden" name="id" value="${dmt.id}">
          <div class="input-append" style="float:left;margin-left:10px;">
            <select style="width:80px;" name="result">
              <option value="">请选择</option>
              <option value="true">通过</option>
              <option value="false">驳回</option>
            </select>
            <input type="text" name="msg" value="${msg}" id="apply_input" style="display:none;"
                   placeHolder="如果驳回，简要填写驳回的原因">
            <button class="btn btn-warning">提交审核</button>
          </div>
        </form>
      #{/if}
  #{/power.ck}
  #{if dmt.apply}
    <div style="float:left;display:inline-block">
      <a href="@{Applys.procure(dmt.apply.id)}" class="btn btn-success">${dmt.apply.serialNumber}
        请款单</a>
    </div>
  #{/if}
  </div>
</div>

<div class="row-fluid">
  <div class="span12 alert">
    <h4 data-toggle="toggle" data-target="#tl">Timeline <i class="icon-reorder"></i></h4>
  </div>
</div>
<div class="row-fluid">
  <div id="tl" class="span12" style="height:350px;"></div>
</div>

#{success_row title:"已经添加进入[采购单]的[采购单元]"/}
<form action="#" id="bulkpost" method="POST">
  <input type="hidden" name="expressid" id="expressid" value="${expressid}">
  <div class="row-fluid">
    <div class="span12" id="unit_list">
    #{if isB2B}
        #{render 'ProcureUnits/_b2b_unit_list.html', units:dmt.units, checkbox:true, key:'delivery', delivery:true/}
    #{/if}
    #{else }
        #{render 'ProcureUnits/_unit_list.html', units:dmt.units, checkbox:true, key:'delivery', delivery:true ,paymentId:paymentId/}
    #{/else}
    </div>
  </div>
  <div class="row-fluid">
    <div class="btn-toolbar">

    </div>

  </div>
#{render 'Deliveryments/_box_number_model.html'/}
#{render 'Deliveryments/_fba_carton_contents.html'/}
</form>

<div class="row-fluid">
  <div class="span12 alert">
    <h4 data-toggle="toggle" data-target="#excel">生成采购单信息 <i class="icon-reorder"></i></h4>
  </div>
</div>
#{if dmt.state == models.procure.Deliveryment.S.CANCEL}
<div id="excel" class="row-fluid" style="display:none;">
  <span class="text-error">采购单已经取消, 不需要生成采购单 Excel</span>
</div>
#{/if}
#{else }
<div id="excel" class="row-fluid" style="display:none;">
  <div class="span12">
    <form id="generate_excel" method="post" action="@{Excels.deliveryment()}">
      <table class="table table-bordered table-condensed">
        <tr>
          <th>交货地址</th>
          <td colspan="7">
          <textarea rows="3" class="span12" name="excel.deliveryAddress" id="excel_deliveryAddress">
            收货时间：法定工作日 8:30-12:00  13:30-18:00，工作日其他时间到货请提前 1 小时联系。
            仓库地址：深圳市光明新区玉律村汉海达科技创新园 1 栋 A 区 6 楼
            电   话：0755-21383192-8060/8061
            收货联系人：
                    Jie：  18692275630
                    杨上德：13724219110
          </textarea>
          </td>
        </tr>

        <tr>
          <th>交易条款<br>(供应商)</th>
          <td colspan="3">
            <textarea rows="8" name="excel.tradeTerms" id="excel_tradeTerms" class="span12"> ${dmt.cooperator.tradingTerms}</textarea>
          </td>
          <th>产品要求<br>(产品线)</th>
          <td colspan="3">
            <div style="overflow:auto;height:150px;width:580px;">
                #{list items:dmt.getCopperItems(), as:'cooperItem'}
                  <a href="@{Cooperators.editCooperItem(cooperItem.id)}" target="_blank" class="btn btn-small btn-info"
                     rel="popover" content="${cooperItem.formatProductTerms()}">
                  ${cooperItem.product.sku}
                  </a>
                #{/list}
            </div>
          </td>
        </tr>

        <tr>
          <th colspan="4"><h5 style="text-align:center">供货方信息</h5></th>
          <th colspan="4"><h5 style="text-align:center">买方信息</h5></th>
        </tr>
        <tr>
          <th>供方</th>
          <td>
            <input type="text" name="excel.supplierCompany" id="excel_supplierCompany" value="${dmt.cooperator.fullName}">
          </td>
          <th>经办人</th>
          <td>
            <input type="text" name="excel.supplier" id="excel_supplier" value="${dmt.cooperator.contacter}">
          </td>

          <th>买方</th>
          <td>
            <input type="text" name="excel.buyerCompany" id="excel_buyerCompany"
                   value="${isB2b ? models.OperatorConfig.getVal("b2bbuyercompany"):models.OperatorConfig.getVal("buyercompany")}">
          </td>
          <th>经办人</th>
          <td>
            <input type="text" name="excel.buyer" id="excel_buyer" value="${dmt.handler?.username}">
          </td>
        </tr>

        <tr>
          <th>移动电话</th>
          <td>
            <input type="text" name="excel.supplierPhone" id="excel_supplierPhone" value="${dmt.cooperator.phone}">
          </td>
          <th>固定电话</th>
          <td>
            <input type="text" name="excel.supplierTel" id="excel_supplierTel" value="${dmt.cooperator.tel}">
          </td>

          <th>移动电话</th>
          <td>
            <input type="text" name="excel.buyerPhone" id="excel_buyerPhone" value="${dmt.handler?.phone}">
          </td>
          <th>固定电话</th>
          <td>
            <input type="text" name="excel.buyerTel" id="excel_buyerTel" value="${isB2b ? '' : models.OperatorConfig.getVal("buyertel")}">
          </td>
        </tr>

        <tr>
          <th>传真</th>
          <td>
            <input type="text" name="excel.supplierFax" id="excel_supplierFax" value="${dmt.cooperator.fax}">
          </td>
          <td colspan="2"></td>


          <th>传真</th>
          <td><input type="text" name="excel.buyerFax" id="excel_buyerFax"></td>

          <th>选择经办人</th>
          <td>
            <select id="chosebuyer">
              <option value="">请选择</option>
                #{list items:buyers, as:'br'}
                    #{ifnot br.username == 'wyatt'}
                      <option value="${br.id}">${br.username}</option>
                    #{/ifnot}
                #{/list}
            </select>
          </td>
        </tr>

        <tr>
          <th>地址</th>
          <td colspan="3">
            <input type="text" class="span12" name="excel.supplierAddress" id="excel_supplierAddress" value="${dmt.cooperator.address}">
          </td>

          <th>地址</th>
          <td colspan="3">
            <input type="text" class="span12" name="excel.buyerAddress" id="excel_buyerAddress"
                   value="${isB2b ? models.OperatorConfig.getVal("b2bbuyeraddress") :models.OperatorConfig.getVal("buyeraddress")}">
          </td>
        </tr>
        <tr>
          <td colspan="4">

          </td>
        </tr>
      </table>
    </form>
  </div>
</div>
#{/else}




<div class="row-fluid">
  <div class="span12">
    <h4 class="alert alert-success">附件 <i class="icon-sort-down"></i></h4>
  </div>
</div>
<div class="row-fluid">
  <div style="min-height:300px;" class="span12 well" id="dropbox">
    <ul class="thumbnails uploaded"></ul>
  #{power.ck "products.edit"}
    <div class="message" style="height:150px;padding-top:145px;text-align:center;">Drag & Drop</div>
  #{/power.ck}
  </div>
</div>


<input type="hidden" id="isNeedApply" value="${isNeedApply}">
<input type="hidden" id="totalSeven" value="${totalSeven}">

