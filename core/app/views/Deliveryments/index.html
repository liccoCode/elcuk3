#{extends 'main_full.html'/}
#{set title:"采购单列表 (${deliveryments.size()})" /}
#{set 'moreScripts'}
#{/set}

<div class="row-fluid">
    <form action="@{Deliveryments.index()}" method="post">
        <div class="span2 input-prepend">
            <span class="add-on">From:</span>
            <input type="date" style="width:90px;" name="p.from" value="${p.from.date()}">
            <span class="add-on" style="margin-left:20px;">To:</span>
            <input type="date" style="width:90px;" name="p.to" value="${p.to.date()}">
        </div>

        <div class="span1">
            <select name="p.state" style="width:80px;">
                <option value="">状态</option>
            #{list items:models.procure.Deliveryment.S.values(), as:'s'}
                <option ${s == p.state ? 'selected' : ''} value="${s}">${s}</option>
            #{/list}
            </select>
        </div>

        <div class="span2 input-prepend input-append">
            <span class="add-on"><i class="icon-search"></i></span>
            <input type="text" name="p.search" class="input-medium" value="${p.search}" placeHolder="可是用 id:xx, +N 语法">
            <button class="btn btn-primary">搜索</button>
        </div>
    </form>
</div>

<div class="row-fluid">
    <div class="span12">
        <table class="table table-condensed table-bordered">
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>State</th>
                <th>User</th>
            </tr>
        #{list items:deliveryments, as:'dmt'}
            <tr>
                <td>
                    <a href="#" target="_blank">${dmt.id}</a>
                </td>
                <td style="cursor:pointer;" data-toggle="toggle" data-target="#dmt_${dmt_index}">
                    <span><i class="icon-reorder"></i></span>
                    <span>${dmt.name}</span>
                    <span class="badge badge-info">${dmt.units.size()}</span>
                </td>
                <td style="color:${'#' + dmt.state.rgb()}">${dmt.state}</td>
                <td>${dmt.handler.username}</td>
            </tr>
            <tr id="dmt_${dmt_index}" style="display:none;">
                <td colspan="4" style="padding:0;border:none">
                    #{render 'Procures/_unit_list.html', units:dmt.units/}
                </td>
            </tr>
        #{/list}
        </table>
    </div>
</div>