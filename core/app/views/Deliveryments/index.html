#{extends 'main_full.html'/}
#{set title:"采购单列表 (${deliveryments.size()})" /}
#{set 'moreScripts'}
#{/set}

#{info_row}
<ul>
    <li><strong>[最先交货时间]</strong>为采购单有交货情况后, 记录的第一次交货时间</li>
    <li><strong>[最后交货时间]</strong>为采购单有交货情况后, 记录的第后一次交货时间</li>
    #{li_net /}
</ul>
#{/info_row}

<div class="row-fluid">
    <form action="@{Deliveryments.index()}" method="post">
        <div class="span3 input-prepend input-append">
            <span class="add-on">From:</span>
            <input type="date" style="width:90px;" name="p.from" value="${p.from.date()}">
            <span class="add-on" style="margin-left:20px;">To:</span>
            <input type="date" style="width:90px;" name="p.to" value="${p.to.date()}">
            <span class="add-on">创建时间</span>
        </div>

        <div class="span1">
            <select name="p.state" style="width:100px;">
                <option value="">状态</option>
            #{list items:models.procure.Deliveryment.S.values(), as:'s'}
                <option ${s == p.state ? 'selected' : ''} value="${s.name()}">${s}</option>
            #{/list}
            </select>
        </div>

        <div class="span2 input-prepend input-append">
            <span class="add-on"><i class="icon-search"></i></span>
            <input type="text" name="p.search" class="input-medium" value="${p.search}" placeHolder="搜索 id 自动识别, +N 语法">
            <button class="btn btn-primary" data-loading>搜索</button>
        </div>
    </form>
</div>

<div class="row-fluid">
    <div class="span12">
        <table class="table table-condensed table-bordered">
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>State</th>
                <th>供应商</th>
                <th>最先交货时间</th>
                <th>最后交货时间</th>
                <th>User</th>
                <th>Create</th>
            </tr>
        #{list items:deliveryments, as:'dmt'}
            #{set twoDeliveryDate: dmt.firstAndEndDeliveryDate()/}
            <tr>
                <td>
                    <a href="@{Deliveryments.show}/${dmt.id}" target="_blank">${dmt.id}</a>
                </td>
                <td style="cursor:pointer;" data-toggle="toggle" data-target="#dmt_${dmt_index}">
                    <span><i class="icon-reorder"></i></span>
                    <span>${dmt.name}</span>
                    <span class="badge badge-info">${dmt.units.size()}</span>
                </td>
                <td style="color:${'#' + dmt.state.rgb()}">${dmt.state}</td>
                <td>${dmt.supplier()?.fullName}</td>
                <td>${twoDeliveryDate._1?.date()}</td>
                <td>${twoDeliveryDate._2?.date()}</td>
                <td>${dmt.handler.username}</td>
                <td>#{time_tooltip time:dmt.createDate/}</td>
            </tr>
            <tr id="dmt_${dmt_index}" style="display:none;">
                <td colspan="8" style="padding:0;border:none">
                    #{render 'Procures/_unit_list.html', units:dmt.units/}
                </td>
            </tr>
        #{/list}
        </table>
    </div>
</div>