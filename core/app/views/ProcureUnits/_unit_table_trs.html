*{需要
* ProcueUnit: unit
* Whouse: whouses
}*
#{set product: unit.selling.listing.product/}

<tr>
  <th style="width:140px;">SellingId</th>
  <td style="width:320px;">
    <input type="text" name="unit.selling.sellingId" id="sellingId" value="${unit.selling.sellingId}"
           style="width:280px;" readonly>
  </td>
  <th style="width:100px;">SKU</th>
  <td>
    <input type="text" name="unit.product.sku" id="unit_sku" value="${product.sku}" readonly>
  </td>
  <th>产品名称</th>
  <td width="320px;"><input type="text" value="${product.abbreviation}" readonly></td>
</tr>

<tr>
#{set copers:product.cooperators() /}
  <th><i class="icon-asterisk" style="color:red"></i>
  #{if Arrays.asList('IN_STORAGE', 'PROCESSING').contains(unit.stage.name())}
    库存数量
  #{/if}
  #{else }采购数量#{/else}
  </th>
  <td colspan="3">
  #{if Arrays.asList('IN_STORAGE', 'PROCESSING').contains(unit.stage.name())}
    <input type="text" class="input-mini" placeHolder="具体数量" name="unit.availableQty" id="availableQty" required
           value="${unit.availableQty}" data-origin="${unit.availableQty}"  #{if unit.isEditInput()} readonly#{/if}>
  #{/if}
  #{else }
    <input type="text" class="input-mini" placeHolder="具体数量" name="unit.attrs.planQty" id="planQty" required
           value="${unit.attrs.planQty}" data-origin="${unit.attrs.planQty}"  #{if unit.isEditInput()} readonly#{/if}>
  #{/else}
    <input type="text" id="box_num" class="input-mini" placeHolder="箱数"  #{if unit.isEditInput()} readonly#{/if}>
    <span class="add-on">箱</span>
    <input type="hidden" name="unit.attrs.qty" value="${unit.attrs.qty}">
    <select name="unit.cooperator.id" native='true' required>
      <option value="">供应商</option>
    #{list items:copers, as:'c'}
      <option value="${c.id}" #{if c.id == unit.cooperator?.id}selected#{/if}>${c.name}</option>
    #{/list}
    </select>
    <span style="width:200px;display:${unit.period?: 'none'}" id="unit_period">（生产周期：${unit.period}天）</span>
  </td>

  <th>单价</th>
  <td>
    <input type="text" class="span3" id="unit_price" name="unit.attrs.price" value="${unit.attrs.price}">
  #{pickCurrency id:'unit_currency', name:'unit.attrs.currency', class:'span3', c:unit.attrs.currency?:helper.Currency.CNY /}
  </td>
</tr>

#{if unit.parent}
    #{if Arrays.asList('IN_STORAGE', 'DELIVERY','PLAN').contains(unit.parent.stage)}
    <tr style="display:none;background-color:#F2DEDE;" id="return_tr">
      <td colspan="6">
        因为父计划<a href="@{ProcureUnits.detail(unit.parent.id)}" target="_blank">${unit.parent.id}</a>
        状态为【${unit.parent.stage?.label()}】，无法退回！
        <input type="hidden" value="false" name="unit.isReturn">否
      </td>
    </tr>
    #{/if}
    #{else }
    <tr style="display:none;background-color:#F2DEDE;" id="return_tr">
      <th>差数是否退回</th>
      <td colspan="5">
        <label class="radio inline">
          <input type="radio" value="true" name="unit.isReturn" checked>退回到父计划
          <a href="@{ProcureUnits.detail(unit.parent.id)}" target="_blank">${unit.parent.id}</a>
        </label>
        <label class="radio inline">
          <input type="radio" value="false" name="unit.isReturn">否
        </label>
      </td>
    </tr>
    #{/else}
#{/if}

<tr>
  <th><i class="icon-asterisk" style="color:red"></i>预计交货日期</th>
  <td>
    <input type="date" name="unit.attrs.planDeliveryDate" value="${unit.attrs.planDeliveryDate.date()}" required>
  #{if oldplanDeliveryDate!=null}
    <span class="add-on">比原预计交货日期${oldplanDeliveryDate.date()}推迟${(unit.attrs
    .planDeliveryDate.getTime()-oldplanDeliveryDate.getTime())/(24*60*60*1000)}天</span>
  #{/if}
    <input type="hidden" name="unit.attrs.deliveryDate" value="${unit.attrs.deliveryDate.date()}">
  </td>
  <th>预计运输时间</th>
  <td>
    <input type="date" name="unit.attrs.planShipDate" value="${unit.attrs.planShipDate.date()}">
  </td>
  <th>预计到库时间</th>
  <td>
    <input type="date" name="unit.attrs.planArrivDate" value="${unit.attrs.planArrivDate.date()}">
    <span class="add-on">? 天</span>
  </td>
</tr>

<tr>
  <th>去往仓库</th>
  <td>
    <select name="unit.whouse.id" id="warehouse_select">
    #{list items:whouses, as:'w'}
      <option value="${w.id}" #{if w.id==unit.whouse?.id} selected #{/if}>${w.name}</option>
    #{/list}
    </select>
  </td>
  <th>采购取样</th>
  <td>
    <input type="text" class="span3" name="unit.purchaseSample" value="${unit.purchaseSample}"/>
    <span class="add-on">个</span>
  </td>
  <th>质检取样</th>
  <td>
    <input type="text" class="span3" value="${unit.fetchCheckTaskQcSample()}" readonly/>
    <span class="add-on">个</span>
  </td>
</tr>

<tr>
  <th>运输方式</th>
  <td>
  #{list items:models.procure.Shipment.T.values(), as:'t'}
    <label class="radio">
      <input type="radio" name="unit.shipType" value="${t.name()}" ${t == unit.shipType ? 'checked': 'unchecked'}>
    ${t.label()}
    </label>
  #{/list}
  </td>
  <th>阶段</th>
  <td>
    <span style="color:${unit.stage.rgb()}">${unit.stage.label()}</span>
    <input type="hidden" name="unit.stage" value="${unit.stage.name()}">
  </td>
  <th>B2B选项</th>
  <td>
    <label class="checkbox inline">
      <input type="checkbox" name="unit.isb2b" value="true" ${unit.projectName=='B2B' ? 'checked':''}> B2B
    </label>
  </td>
</tr>
<tr>
  <td colspan="6">
  #{list items: unit.relateShipment()}
    <div>
      <a href="@{Shipments.show(_.id)}" target="_blank">${_.id} (${_.type.label()})</a>
      <input type="hidden" id="shipmentId" value="${_.id}">
      <span><i class="icon-calendar"></i> #{time_tooltip time: _.dates.planBeginDate/}</span>
      <span><i class="icon-calendar"></i> #{time_tooltip time: _.predictArriveDate()/}</span>
    </div>
  #{/list}
  </td>
</tr>

<tr>
  <td colspan="6">
    <h4>Memo</h4>
    <textarea rows="8" class="span12" name="unit.comment" id="memo">${unit.comment.raw()}</textarea>
  </td>
</tr>


<input type="hidden" id="unit_type" value="${unit.type.name()}">