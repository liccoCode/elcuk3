#{extends 'main_full.html'/}
#{set title:"分拆采购计划 #" + unit.id /}
#{set 'moreScripts'}
    #{script 'procureunits/splitUnit.coffee' /}
#{/set}

#{errorMsgs /}

#{info_row title:'原始采购计划' /}
<div class="row-fluid">
  <div class="span12">
    <table class="table table-condensed table-bordered">
      <tr>
        <th>#</th>
        <td>${unit.id}</td>

        <th>Selling</th>
        <td>${unit.selling.sellingId}</td>

        <th>SKU</th>
        <td>${unit.sku}</td>
      </tr>

      <tr>
        <th>仓库</th>
        <td>${unit.whouse.name}</td>

        <th>供应商</th>
        <td>${unit.cooperator.fullName}</td>

        <th>采购数量</th>
        <td>${unit.qty()}</td>
      </tr>

      <tr>
        <th>预计交货时间</th>
        <td>#{time_tooltip time:unit.attrs.planDeliveryDate/}</td>

        <th>预计运输时间</th>
        <td>#{time_tooltip time:unit.attrs.planShipDate/}</td>

        <th>预计到库时间</th>
        <td>#{time_tooltip time:unit.attrs.planArrivDate/}</td>
      </tr>

      <tr>
        <th>单价</th>
        <td>${unit.attrs.price.format("#.##")} ${unit.attrs.currency.name()}</td>

        <th>阶段</th>
        <td style="background:${unit.stage.rgb()}">${unit.stage}</td>

        <th>采购单</th>
        <td>${unit.deliveryment.id}</td>
      </tr>

      <tr>
        <th>运输方式</th>
        <td>${unit.shipType}</td>

        <th>是否到货代</th>
        <td>#{yesOrNo f:unit.isPlaced/}</td>

        <td colspan="3"></td>
      </tr>
    </table>
  </div>
</div>


#{success_row title:'分拆的计划' /}

<div class="row-fluid">
  <div class="span12">
    <form action="@{ProcureUnits.doSplitUnit(unit.id)}" method="POST">
    #{authenticityToken /}
      <table class="table table-condensed table-bordered">
        <tr>
          <th>#</th>
          <td>&nbsp;</td>

          <th>Selling</th>
          <td>${unit.selling.sellingId}</td>

          <th>SKU</th>
          <td>${unit.sku}</td>
        </tr>

        <tr>
          <th>仓库</th>
          <td>${unit.whouse.name}</td>

          <th>供应商</th>
          <td>${unit.cooperator.fullName}</td>

          <th>采购数量</th>
          <td>
            <input type="text" name="newUnit.attrs.planQty" value="${newUnit.attrs.planQty}">
          </td>
        </tr>

        <tr>
          <th>预计交货时间</th>
          <td>
            <input type="date" name="newUnit.attrs.planDeliveryDate" value="${newUnit.attrs.planDeliveryDate.date()}">
          </td>

          <th>预计运输时间</th>
          <td>
            <input type="date" name="newUnit.attrs.planShipDate" value="${newUnit.attrs.planShipDate.date()}">
          </td>

          <th>预计到库时间</th>
          <td>
            <input type="date" name="newUnit.attrs.planArrivDate" value="${newUnit.attrs.planArrivDate.date()}">
          </td>
        </tr>

        <tr>
          <th>单价</th>
          <td>${unit.attrs.price} ${unit.attrs.currency.name()}</td>

          <th>阶段</th>
          <td>${models.procure.ProcureUnit.STAGE.DELIVERY}</td>

          <th>采购单</th>
          <td>
            <a href="@{Deliveryments.show(unit.deliveryment.id)}" target="_blank">${unit.deliveryment.id}</a>
          </td>
        </tr>

        <tr>
          <th>运输方式</th>
          <td>${unit.shipType}</td>

          <th>是否到货代</th>
          <td>#{yesOrNo f: unit.isPlaced/}</td>

          <td colspan="2"></td>
        </tr>

        <tr>
          <td colspan="6">
            <h4>Comment</h4>
            <textarea rows="5" class="span12" name="newUnit.comment">${newUnit.comment.raw()}</textarea>
          </td>
        </tr>
        <tr>
          <td colspan="6">
            <input type="hidden" name="newUnit.attrs.deliveryDate" value="${newUnit.attrs.deliveryDate.date()}">
            <a href="@{Deliveryments.show(unit.deliveryment.id)}" class="btn btn-success">回到采购单</a>
          #{power.ck "procures.dosplitunit"}
            <button data-confirm="确认分拆前, 请再确认一次分拆的数量,地址等信息" class="btn btn-primary">
              分拆
            </button>
          #{/power.ck}
          </td>
        </tr>
      </table>
    </form>
  </div>
</div>
