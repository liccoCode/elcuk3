*{
1. checkbox: [true]|false; 是否拥有 checkbox 框框
2. shipmentId: [null]|<shipmentId>; 是否体现取消运输项目功能
3. itmRecord: [false]|true; 是否加载 Record
4. fbaRecord: [false]|true; 是否加载 FBA 的入库信息
}*
#{set useCheckbox: checkbox == null || checkbox /}
<table class="table table-condensed table-bordered">
  <tr>
  #{if useCheckbox}
    <th>
      <label class="checkbox">
        <input type="checkbox" class="checkbox_all"/>
      </label>
    </th>
  #{/if}
    <th>#</th>
    <th>Sku</th>
    <th>Selling</th>
  #{if useCheckbox}
    <th>FBA</th>
    <th>CenterId</th>
  #{/if}
    <th><abbr rel='tooltip' title='运输数量 (计划数量 | 交货数量)'>Qty</abbr></th>
    <th class="five">Receive</th>
    <th>Qty1</th>
    <th>采购单</th>
    <th>预计发货时间</th>
    <th>预计到库时间</th>
    <th>实际交货时间</th>
    <th>供应商</th>
    <th>总重量(kg)</th>
    <th>抵达?</th>
    <th>是否合格</th>
    <th>是否发货</th>
    <th>质检信息</th>
  #{if useCheckbox}
    <th>运往仓库</th>
  #{/if}
    <th>采购计划</th>
    <th>运营创建人</th>
    <th>采购创建人</th>
    <th>丢失量/赔偿金额</th>
  #{power.ck 'paymentunits.postfromtransport'}
      #{if isExpress}
        <th>记录运费</th>
      #{/if}
  #{/power.ck}
  </tr>
#{list items:items, as:'itm'}
  <tr id="${itm.id}" data-received-url='@{ShipItems.received(itm.id)}'
      data-lossqty='${itm.lossqty}' data-compenamt='${itm.compenamt}'
      data-currency='${itm.currency?.name()}' data-compentype='${itm.compentype}'>
      #{if useCheckbox}
        <td>
          <label class="checkbox">
            <input type="checkbox" name="shipItemId" value="${itm.id}" id="checkbox_${itm.id}">
          </label>
        </td>
      #{/if}
    <td>${itm.id}</td>
    <td><a href="@{Products.show(itm.unit.sku)}" target="_blank">${itm.unit.sku}</a></td>
    <td><a id="unitbutton">${itm.unit.sid}</a></td>
      #{if useCheckbox}
          #{if itm.unit.fba}
            <td>
                #{if itm.unit.fba.records}
                  <a href="${itm.unit.fba.fbaLink()}" target="_blank">
                  <span rel='popover' placement='bottom' full-width="true" content="${itm.unit.fba?.records()}">
                  ${itm.unit.fba.shipmentId}
                  </span>
                  </a>
                  <i class="icon-search"></i>
                #{/if}
                #{else }
                  <a href="${itm.unit.fba.fbaLink()}" target="_blank">${itm.unit.fba.shipmentId}</a>
                #{/else}
            </td>
          #{/if}
          #{else }
            <td>&nbsp;</td>
          #{/else}
        <td>${itm.unit.fba?.centerId}</td>
      #{/if}
    <td style="${itm.qty != itm.unit.qty() ? 'background:#F2DEDE' : ''}">
    ${itm.qty - itm.unit.returnPurchaseSample() - itm.unit.fetchCheckTaskQcSample()}
      (${itm.unit.attrs.planQty} | ${itm.unit.attrs.qty})
    </td>
    #{if itmRecord}
      <td style="#{if itm.recivedQty != itm.qty || itm.changeFromZero()}background:#F2DEDE#{/if}"
          name='recivedQty' placement='right' rel='popover'>
      ${itm.recivedQty}
      </td>
    #{/if}
    #{else }
      <td style="${itm.recivedQty != itm.qty ? 'background:#F2DEDE' : ''}">
      ${itm.recivedQty}
      </td>
    #{/else}

    #{if itmRecord}
      <td style="#{if itm.adjustQty != itm.qty || itm.changeFromZero()}background:#F2DEDE#{/if}"
          name='adjustQty' placement='right' rel='popover' content='#{records_ul records: itm.recivedLogs()/}'>
      ${itm.adjustQty}<i class="icon-wrench"></i>
      </td>
    #{/if}
    #{else }
      <td style="${itm.adjustQty != itm.qty ? 'background:#F2DEDE' : ''}" name="adjustQty"
          content='#{records_ul records: itm.recivedLogs()/}'>
      ${itm.adjustQty}<i class="icon-wrench"></i>
      </td>
    #{/else}

    <td>
      <a href="@{Deliveryments.show(itm.unit.deliveryment?.id)}#${itm.unit.id}">
      ${itm.unit.deliveryment?.id}
      </a>
    </td>
    <td style="background:${itm.overdue()}">
        #{time_tooltip time: itm.unit.attrs.planShipDate/}
    </td>
    <td>#{time_tooltip time: itm.unit.attrs.planArrivDate/}</td>
    <td>#{time_tooltip time: itm.unit.attrs.deliveryDate/}</td>
    <td>${itm.unit.cooperator?.name}</td>
    <td>${itm.totalWeight()}</td>
    <td>#{yesOrNo f:itm.unit.isPlaced /}</td>
    <td>${itm.unit.result()}</td>
    <td>${itm.unit.isship()}</td>
    <td>
        #{if itm.unit.fetchCheckTaskLink() != null}
          <a href="${itm.unit.fetchCheckTaskLink()}" target="_blank">查看</a>
        #{/if}
    </td>

      #{if useCheckbox}
        <td>${itm.unit.whouse.name()}</td>
      #{/if}
    <td>
      <a href="@{Deliveryments.show(itm.unit.deliveryment?.id)}#${itm.unit.id}">
      ${itm.unit.id}
      </a>
    </td>
    <td>${itm.unit.handler.username}</td>
    <td>${itm.unit.deliveryment?.handler?.username}</td>
    <td>${itm.lossqty}/${itm.compenamt}${itm.currency?.name()}</td>
      #{power.ck 'paymentunits.postfromtransport'}
          #{if isExpress}
            <td>
              <a class="btn btn-mini" data-url='@{PaymentUnits.fromShipItem(itm.id)}'>L</a>
            </td>
          #{/if}
      #{/power.ck}
  </tr>
#{/list}
#{if shipmentId}
  <tr>
    <td colspan="${useCheckbox ? 15 : 13}">
      <input type="hidden" name="id" value="${shipmentId}">
        #{power.ck "shipments.cancelship"}
          <button id="cancel_shipitem" class="btn btn-warning">取消运输</button>
        #{/power.ck}
    </td>
  </tr>
#{/if}
</table>