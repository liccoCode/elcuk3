#{extends 'main_full.html' /}
#{set title:"运输单 #" + ship.id /}
#{set 'moreScripts'}
    #{script 'jquery.filedrop.js'/}
    #{script 'component/dropUpload.coffee'/}
    #{script 'shipments/show.coffee'/}
#{/set}

#{errorMsgs /}

#{flash_alert /}

#{info_row title:'采购单信息 <i class="icon-caret-down"></i>'.raw() /}
<div class="row-fluid">
  <div class="span12">
  #{render './_shipment.html', ship: ship, whouses: whouses/}
  </div>
</div>

<div class="row-fluid">
  <div class="span12" style="margin-bottom:15px;">

  #{power.ck "shipments.beginship"}
      #{if isPlanAndConfirm}
        <form action="@{Shipments.beginShip()}" method="post" class="pull-left">
          <input type="hidden" name="id" value="${ship.id}">
            #{authenticityToken /}
          <button style="margin-right:10px;" data-confirm="确认开始运输?" class="btn btn-success">
            开始运输
          </button>
        </form>
      #{/if}
  #{/power.ck}
  #{power.ck 'shipments.cancel'}
      #{if ship.state in [models.procure.Shipment.S.PLAN, models.procure.Shipment.S.CONFIRM]}
        <form action="@{Shipments.cancel()}" method="post">
          <input type="hidden" name="id" value="${ship.id}">
            #{authenticityToken /}
          <button style="margin-right:10px;" data-confirm="确认取消运输?" class="btn btn-danger">
            取消运输单
          </button>
        </form>
      #{/if}
  #{/power.ck}
  </div>
</div>


#{success_row title:'运输项目' /}
<div class="row-fluid">
  <div class="span12">
  #{render './_shipitem.html', items: ship.items/}
  </div>
</div>
<div class="row-fluid">
  <div class="span3">
    <input type="text" name="shipmentId" placeholder="ShipmentId" style="margin-bottom:0">

    <div class="btn-group">
      <button class="btn" id="previewBtn"><i class="icon-file-alt"></i> 预览</button>
      <button class="btn btn-success"><i class="icon-adjust"></i> 调整</button>
    </div>
  </div>

  <div class="span9" id="preview">
  </div>
</div>

<div class="row-fluid" style="margin-top:20px">
  <div class="span6">
  #{records records:records/}
  </div>

  <div class="span6">
    <div class="row-fluid">
      <div class="span12">
        <h4 class="text-warning">
          运输进度
          <i class="icon-sort-down"></i>
          &nbsp;
          <a href="@{Shipments.refreshProcuress(ship.id)}" class="btn btn-mini btn-danger" data-method='PUT'>
            <i class="icon-refresh"></i>
          </a>
        </h4>
      </div>
    </div>
    <div id="shipping_details" class="span12">
    #{if ship.iExpressHTML.trim().size() > 0}
    ${ship.iExpressHTML.raw()}
    #{/if}
    #{else }
      还没有跟踪信息
    #{/else}
    </div>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h4 class="alert alert-success">附件 <i class="icon-sort-down"></i></h4>
  </div>
</div>
<div class="row-fluid">
  <div style="min-height:300px;" class="span12 well" id="dropbox">
    <ul class="thumbnails uploaded"></ul>
    <div class="message" style="height:150px;padding-top:145px;text-align:center;">Drag & Drop</div>
  </div>
</div>
