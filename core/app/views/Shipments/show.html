#{extends 'main_full.html' /}
#{set title:"运输单 #" + ship.id /}
#{set 'moreScripts'}
    #{script 'jquery.filedrop.js'/}
    #{script 'component/dropUpload.coffee'/}
    #{script 'shipments/show.coffee'/}
#{/set}

#{errorMsgs /}

#{flash_alert /}

#{info_row title:'采购单信息 <i class="icon-caret-down"></i>'.raw() /}
<div class="row-fluid">
  <div class="span12">
  #{render './_shipment.html', ship: ship, whouses: whouses, shippers: shippers/}
  </div>
</div>

<div class="row-fluid">
  <div class="btn-toolbar">
  #{if ship.state == models.procure.Shipment.S.PLAN}
    <a href="@{Shipments.confirm(ship.id, false)}" data-confirm="确认操作?" data-method="POST"
       class="btn  btn-warning" data-disable-with="确认中...">
      确认运输单
    </a>
  #{/if}
  #{if ship.state == models.procure.Shipment.S.CONFIRM}
    <a href="@{Shipments.confirm(ship.id, true)}" data-confirm="确认操作?" data-method="POST"
       class="btn  btn-warning" data-disable-with="确认中...">
      取消确认运输单
    </a>
  #{/if}
  #{power.ck "shipments.beginship"}
      #{if ship.state == models.procure.Shipment.S.CONFIRM}
        <a href="@{Shipments.beginShip(ship.id)}" class="btn btn-success"
           data-confirm="确认开始运输?" data-method='POST' data-disable-with='更新中...'>
          开始运输
        </a>
      #{/if}
  #{/power.ck}
  #{power.ck 'shipments.cancel'}
      #{if ship.state == models.procure.Shipment.S.PLAN}
        <a href="@{Shipments.cancel(ship.id)}" class="btn btn-danger" data-confirm="确认取消运输?"
           data-method="DELETE" data-disable-with="取消中...">
          取消运输单
        </a>
      #{/if}
  #{/power.ck}
  </div>
</div>


#{success_row title:'运输项目' /}
<form action="@{ShipItems.adjust(ship.id, ship.id)}" method="POST" id="adjust_shipitems">

  <div class="row-fluid">
    <div class="span12">
    #{render './_shipitem.html', items: ship.items/}
    </div>
  </div>
  <div class="row-fluid">
    <div class="span3">
      <input type="text" name="shipmentId" placeholder="ShipmentId" style="margin-bottom:0">

      <div class="btn-group">
        <button class="btn" id="previewBtn"><i class="icon-file-alt"></i> 预览</button>
        <button class="btn btn-success adjust" data-disable-with='调整中...' data-confirm="确认调整?">
          <i class="icon-adjust"></i>
          调整
        </button>
      </div>
    </div>

    <div class="span9" id="preview">
    </div>
  </div>
</form>

<div class="row-fluid" style="margin-top:20px">
  <div class="span6">
  #{records records:records/}
  </div>

  <div class="span6">
    <div class="row-fluid">
      <div class="span12">
        <h4 class="text-warning">
          运输进度
          <i class="icon-sort-down"></i>
          &nbsp;
          <a href="@{Shipments.refreshProcuress(ship.id)}" class="btn btn-mini btn-danger" data-method='PUT'>
            <i class="icon-refresh"></i>
          </a>
        </h4>
      </div>
    </div>
    <div id="shipping_details" class="span12">
    #{if ship.iExpressHTML.trim().size() > 0}
    ${ship.iExpressHTML.raw()}
    #{/if}
    #{else }
      还没有跟踪信息
    #{/else}
    </div>
  </div>
</div>

<div class="row-fluid">
  <div class="span12">
    <h4 class="alert alert-success">附件 <i class="icon-sort-down"></i></h4>
  </div>
</div>
<div class="row-fluid">
  <div style="min-height:300px;" class="span12 well" id="dropbox">
    <ul class="thumbnails uploaded"></ul>
    <div class="message" style="height:150px;padding-top:145px;text-align:center;">Drag & Drop</div>
  </div>
</div>
