#{set useCheckbox: checkbox == null || checkbox /}
<table class="table table-condensed table-bordered" id="shipmentTable">
  <tr>
  #{if useCheckbox}
    <th>
      <label class="checkbox">
        <input type="checkbox" class="checkbox_all"/>
      </label>
    </th>
  #{/if}
    <th>出库Id</th>
    <th>状态</th>
    <th>SKU</th>
    <th>selling</th>
    <th>产品名称</th>
    <th>最新采购价</th>
    <th>报关类型</th>
    <th>去往仓库</th>
    <th>FBA</th>
    <th>CenterId</th>
    <th>Qty(计划/实际)</th>
    <th>Receive</th>
    <th>Qty1</th>
    <th>预计运输时间</th>
    <th>预计到库时间</th>
    <th>箱数</th>
    <th>总重量</th>
    <th>总体积</th>
    <th>运营对接人</th>
    <th>仓库对接人</th>
    <th>丢失量/赔偿金额</th>
  </tr>
#{list items:items, as:'item'}
    #{if item.plan}
        #{set plan: item.plan/}
      <tr id="${item.id}" data-received-url='@{ShipItems.received(item.id)}'
          data-lossqty='${item.lossqty}' data-compenamt='${item.compenamt}'
          data-currency='${item.currency?.name()}' data-compentype='${item.compentype}'>
          #{if useCheckbox}
            <td>
              <label class="checkbox">
                <input type="checkbox" name="shipItemId" value="${item.id}" id="checkbox_${item.id}">
              </label>
            </td>
          #{/if}
        <td>
          <a target="_blank" href="@{ShipPlans.show(plan.id)}">${plan.id}</a>
        </td>
        <td>${plan.state.label()}</td>
        <td><a href="@{Products.show(plan.product?.sku)}" target="_blank">${plan.product?.sku}</a></td>
        <td><a href="@{Sellings.selling(plan.selling?.sellingId)}" target="_blank">${plan.selling?.sellingId}</a></td>
        <td>${plan.product?.abbreviation}</td>
        <td>
            #{if plan.unit}
            ${plan.unit.attrs.price}
            #{/if}
          #{else }
        ${item.showSkuPrice()}
        #{/else}
        </td>
        <td>${plan.outboundRecord()?.clearanceType?.label()}</td>
        <td>${plan.whouse.name}</td>
        <td>${plan.fba?.shipmentId}</td>
        <td>${plan.fba?.centerId}</td>
        <td>${plan.planQty}/${plan.qty}</td>
        <td>${item.recivedQty}</td>
        <td>${item.adjustQty}</td>
        <td>#{time_tooltip time:plan.planShipDate/}</td>
        <td>#{time_tooltip time:plan.planArrivDate/}</td>
        <td>${plan.totalBoxNum()}</td>
        <td>${plan.totalWeight()}</td>
        <td>${plan.totalVolume()}</td>
        <td>${plan.creator?.username}</td>
        <td>${item.showName()}</td>
        <td>${item.lossqty}/${item.compenamt}${item.currency?.name()}</td>
      </tr>
    #{/if}
    #{else}
      <tr id="${item.id}" data-received-url='@{ShipItems.received(item.id)}'
          data-lossqty='${item.lossqty}' data-compenamt='${item.compenamt}'
          data-currency='${item.currency?.name()}' data-compentype='${item.compentype}'>
          #{if useCheckbox}
            <td>
              <label class="checkbox">
                <input type="checkbox" name="shipItemId" value="${item.id}" id="checkbox_${item.id}">
              </label>
            </td>
          #{/if}
        <td><a target="_blank" href="@{Deliveryments.show(item.unit.deliveryment?.id)}#${item.unit.id}">${item.unit.id}</a>
        </td>
        <td>${item.unit()?.isOut?.label()}</td>
        <td>${item.unit()?.sku}</td>
        <td>${item.unit()?.sid}</td>
        <td>${item.unit()?.product?.abbreviation}</td>
        <td>${item.unit()?.attrs?.price}</td>
        <td></td>
        <td>${item.unit()?.whouse?.name()}</td>
        <td><a href="${item.unit()?.fba?.fbaLink()}" target="_blank">${item.unit()?.fba?.shipmentId}</a></td>
        <td>${item.unit()?.fba?.centerId}</td>
        <td>
            #{if item.unit()}
            ${item.qty - item.unit().returnPurchaseSample() - item.unit().fetchCheckTaskQcSample()}
            #{/if}
          (${item.unit()?.attrs?.planQty} | ${item.unit()?.attrs?.qty})
        </td>
        <td style="#{if item.recivedQty != item.qty || item.changeFromZero()}background:#F2DEDE#{/if}"
            name='recivedQty' placement='right' rel='popover'>${item.recivedQty}
        </td>
        <td style="${item.adjustQty != item.qty ? 'background:#F2DEDE' : ''}" name="adjustQty"
            content='#{records_ul records: item.recivedLogs()/}'>${item.adjustQty}<i class="icon-wrench"></i>
        </td>
        <td style="background:${item.overdue()}">#{time_tooltip time: item.unit()?.attrs?.planShipDate/}</td>
        <td>#{time_tooltip time: item.unit()?.attrs?.planArrivDate/}</td>
        <td></td>
        <td>${item.totalWeight()}</td>
        <td></td>
        <td></td>
        <td></td>
        <td>${item.lossqty}/${item.compenamt}${item.currency?.name()}</td>
      </tr>
    #{/else}
#{/list}
</table>