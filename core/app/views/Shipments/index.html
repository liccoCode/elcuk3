#{extends 'main_full.html' /}
#{set title:'运输单列表 (' + shipments.size() + ')' /}
#{set 'moreScripts'}
#{/set}

#{info_row}
<ul>
    #{li_net /}
</ul>
#{/info_row}

<div class="row-fluid">
    <form action="@{Shipments.index()}" method="post">
        <div class="span3 input-prepend">
            <span class="add-on">From:</span>
            <input type="date" style="width:90px;" name="p.from" value="${p.from.date()}">
            <span class="add-on" style="margin-left:20px;">To:</span>
            <input type="date" style="width:90px;" name="p.to" value="${p.to.date()}">
            <select name="p.dateType" style="width:130px;margin-left:20px;">
            #{list items:dateTypes, as:'t'}
                <option ${t._1 == p.dateType ? 'selected' : ''} value="${t._1}">${t._2}</option>
            #{/list}
            </select>
        </div>

        <div class="span4">
            <select name="p.pype" style="width:90px">
                <option value="">计价方式</option>
            #{list items:models.procure.Shipment.P.values(), as:'pype'}
                <option ${pype == p.pype ? 'selected' : ''} value="${pype.name()}">${pype}</option>
            #{/list}
            </select>

            <select name="p.type" style="width:90px;margin-left:15px;">
                <option value="">运输方式</option>
            #{list items:models.procure.Shipment.T.values(), as:'t'}
                <option ${t == p.type ? 'selected' : ''} value="${t.name()}">${t}</option>
            #{/list}
            </select>

            <select name="p.state" style="width:90px;margin-left:15px;">
                <option value="">状态</option>
            #{list items:models.procure.Shipment.S.values(), as:'state'}
                <option ${state == p.state ? 'selected' : ''} value="${state.name()}">${state}</option>
            #{/list}
            </select>

            <select name="p.iExpress" style="width:98px;margin-left:15px;">
                <option value="">国际快递商</option>
            #{list items:models.procure.Shipment.iExpress(), as:'express'}
                <option ${express == p.iExpress ? 'selected' : ''} value="${express.name()}">${express}</option>
            #{/list}
            </select>

            <select name="p.whouseId" style="width:98px;margin-left:15px;">
                <option value="">运往仓库</option>
            #{list items:whouses, as:'wh'}
                <option ${wh.id == p.whouseId ? 'selected' : ''} value="${wh.id}">${wh.name()}</option>
            #{/list}
            </select>
        </div>
        <div class="span3 input-append input-prepend">
            <span class="add-on"><i class="icon-search"></i></span>
            <input type="text" name="p.search" value="${p.search}">
            <button class="btn btn-primary">搜索</button>
        </div>
        <div class="span1 pull-right">
            <a href="@{Shipments.blank()}" class="btn btn-primary">创建新运输单</a>
        </div>
    </form>
</div>

<div class="row-fluid">
    <div class="span12">
        <table class="table table-condensed table-bordered">
            <tr>
                <th>#</th>
                <th>Track No.</th>
                <th>运输方式</th>
                <th>去往仓库</th>
                <th>Title</th>
                <th>目的地</th>
                <th>国际快递</th>
                <th>状态</th>
                <th>计价方式</th>
                <th>运输商</th>
                <th>开始时间</th>
                <th>创建时间</th>
                <th>预计到库时间</th>
                <th>创建者</th>
            </tr>
        #{list items:shipments, as:'ship'}
            <tr>
                <td>
                    <a target="_blank" href="@{Shipments.show()}/${ship.id}">${ship.id}</a>
                </td>
                <td style="cursor:pointer;" data-toggle="toggle" data-target="#ship_${ship_index}">
                    <i class="icon-reorder"></i> ${ship.trackNo}
                    <span class="badge badge-info">${ship.items.size()}</span>
                </td>
                <td>${ship.type}</td>
                <td>${ship.whouse?.name()}</td>
                <td>${ship.title}</td>
                <td>${ship.target}</td>
                <td>${ship.internationExpress}</td>
                <td style="color:${'#' + ship.state.rgb()}">${ship.state}</td>
                <td>${ship.pype}</td>
                <td>${ship.cooper?.name}</td>
                <td>#{time_tooltip time:ship.beginDate/}</td>
                <td>#{time_tooltip time:ship.createDate/}</td>
                <td>#{time_tooltip time:ship.planArrivDate/}</td>
                <td>${ship.creater?.username}</td>
            </tr>
            <tr id="ship_${ship_index}" style="display:none;">
                <td colspan="12">
                    <div class="span4" style="float:left;">
                        <h4 class="text-info">Commemt</h4>
                    ${ship.memo.raw()}
                    </div>
                    <div class="span8" style="float:left;">
                        #{list items:ship.items, as:'shipitem'}
                        ${shipitem.unit.sid}<br/>
                        #{/list}
                    </div>
                </td>
            </tr>
        #{/list}
        </table>
    </div>
</div>
