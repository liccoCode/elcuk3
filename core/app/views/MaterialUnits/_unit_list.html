#{set tr_key: key ? key : 'unit'/}
<table class="table table-condensed table-bordered dataTable" id="unit_table">
  <tr>
  #{if materialUnitsIndex}
    <th width="20px;">
      <label class="checkbox">
        <input type="checkbox" id="${key ? tr_key + '_' : ''}checkbox_all" class="${tr_key} checkall" value="">
      </label>
    </th>
  #{/if}
    <th>物料计划ID</th>
    <th width="40px;">阶段22</th>
    <th width="150px;">物料编码</th>
    <th width="130px;">物料名称</th>
    <th>物料采购单<br>供应商</th>
    <th width="100px;">数量<br>(计划/交货/入库)</th>
    <th>采购余量</th>
    <th>单价</th>
    <th>总价</th>
    <th>剩余请款金额</th>
  #{if materialUnitsIndex}
  <th>Action
  #{/if}
    <th>预计交货时间</th>
    <th>实际交货时间</th>
    <th>质检状态</th>
    <th>质检结果</th>
    <th>包装信息</th>
    <th>项目名称</th>
    <th>创建人</th>
    <th>创建时间</th>
  </tr>


#{list items:units, as:'unit'}
  <tr id="procureUnit_${unit.id}">

      #{if materialUnitsIndex}
        <td>
          <input type="checkbox" name="pids" value="${unit.id}" project="${unit.projectName}" cooper="${unit.cooperator?.id}">
        </td>
      #{/if}
    <td data-toggle="toggle" data-target="#${tr_key}_${unit.id}" style="cursor:pointer;">
    ${unit.id}
    </td>
    <td style="background:${unit.stage.rgb()}">${unit.stage.label()}</td>

    <td>${unit.material?.code}${str}</td>
    <td>${unit.material?.name}</td>
    <td>${unit.materialPurchase?.id}<br>${unit.cooperator?.name}</td>
    <td #{if unit.planQty != unit.qty && (unit.qty !=0 && unit.inboundQty)} style="color:red"#{/if}>
    ${unit.planQty}/${unit.qty}/${unit.inboundQty}
    </td>
    <td>${unit.availableQty}</td>
    <td>${unit.planPrice}</td>
    <td>${unit.planQty}*${unit.planPrice}</td>
    <td>${unit.planQty}*${unit.planPrice}</td>
    <td>
        #{if materialUnitsIndex}
          <a href="javascript:void(0)" name="unitUpdateBtn" class="btn btn-small btn-primary" id="qs_${unit.id}"
             uid="${unit.id}">修改</a>
        #{/if}
    </td>

    <td>#{time_tooltip time:unit.planDeliveryDate/}</td>
    <td>#{time_tooltip time:unit.deliveryDate/}</td>
    <td>
        #{if unit.result}
          <a href="@{Inbounds.editByUnitId(unit.id)}" target="_blank">
          ${unit.result.name()=='UnCheck'? '未检' : '已检'}
          </a>
        #{/if}
    </td>
    <td>
        #{if unit.result?.name()=='Qualified'}
          <i style="color:green" class="icon-ok"></i>
        #{/if}
        #{elseif unit.result?.name()=='Unqualified'}
          <i style="color:red" class="icon-remove"></i>
        #{/elseif}
    </td>
    <td>
        #{if unit.stage.name()=='IN_STORAGE'}
          <input type="button" data-id="${unit.id}" name="editBoxInfo" value="填写"
                 class="btn btn-mini ${unit.validBoxInfoIsCorrect() ? 'btn-success' : 'btn-danger'}">

        #{/if}
    </td>
    <td>${unit.projectName}</td>
    <td>${unit.handler?.username}</td>
    <td>#{time_tooltip time:unit.createDate/}</td>
  </tr>


#{/list}
#{if p != null}
  <tr class="tb_footer">
    <td colspan="25">
        #{bootstrap_pager pi:p, url:'' /}
    </td>
  </tr>
#{/if}
</table>

<!-- Ship To Modal -->
<div id="fba_ship_to_modal" class="modal hide fade">
  <div class="modal-body" id="fba_ship_to_body"></div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">OK</button>
  </div>
</div>