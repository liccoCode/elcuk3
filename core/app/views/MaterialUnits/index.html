#{extends 'main_full.html' /}
#{set title:"物料采购计划列表 (${p.count()})"  /}
#{set 'moreStyles'}
    #{stylesheet 'bootstrap-multiselect.css'/}
#{/set}
#{set 'moreScripts'}
    #{script 'bootstrap-multiselect.js'/}
    #{script 'component/pagination.coffee'/}
    #{script 'materialUnits/index.es6'/}
    #{script 'materialUnits/index.coffee'/}
#{/set}
<style>
  .table td{
    vertical-align:middle;
  }
</style>
#{errorMsgs /}
#{flash_alert /}


<div class="row-fluid">
  <form action="@{MaterialUnits.index()}" method="get" class="search_form" id="search_Form">
    <div class="row-fluid">
      <div class="span12">
        <div class="input-prepend input-append inline">
          <span class="add-on">From:</span>
          <input type="date" name="p.from" value="${p.from.date()}">
          <span class="add-on">To:</span>
          <input type="date" name="p.to" value="${p.to.date()}">
        </div>

        <select name="p.dateType" class="inline">
        #{list items:p.DATE_TYPES, as:'t'}
          <option ${t._1 == p.dateType ? 'selected' : ''} value="${t._1}">${t._2}</option>
        #{/list}
        </select>


        <div class="input-prepend inline">
          <select name="p.stages" multiple="multiple" id="stage">
            <option value="">阶段</option>
          #{list items:models.procure.ProcureUnit.STAGE.values(), as:'stage'}
              #{if stage.label() != '审批中'}
                <option value="${stage.name()}" ${p.stages.contains(stage) ? 'selected' : ''}>${stage.label()}</option>
              #{/if}
          #{/list}
          </select>
        </div>

        <select name="p.cooperatorId" class="inline selectize" style="width:150px;">
          <option value="">供应商</option>
        #{list items:cooperators, as:'cop'}
          <option ${cop.id == p.cooperatorId ? 'selected' : ''} value="${cop.id}">${cop.name}</option>
        #{/list}
        </select>

        <select name="p.materialId" class="inline">
          <option value="">物料类型</option>
        #{list items:models.material.Material.T, as:'t'}
          <option value="${t.name()}" ${p.type.contains(t) ? 'selected' : ''}>${t.label()}</option>
        #{/list}
        </select>

        <select name="p.projectName" class="inline">
          <option value="">项目名称</option>
        #{list items:models.User.COR, as:'c'}
            #{if java.util.Arrays.asList(brandName,models.User.COR.MengTop.name()).contains(c.name())}
              <option ${c.name() == p.projectName ? 'selected' : ''} value="${c.name()}">${c.label()}</option>
            #{/if}
        #{/list}
        </select>

        <div class="input-prepend input-append inline">
          <span class="add-on"><i class="icon-search"></i></span>
          <input type="text" style="width:200px;" name="p.search" placeholder="物料计划ID,物料编码" value="${p.search}">
          <input type="hidden" name="p.page" value="${p.page}">
          <button class="btn btn-primary" data-loading>搜索</button>
        </div>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span12">
        <div class="input-prepend input-append inline">
          <a href="@{MaterialUnits.planView(tomorrow1)}" class="btn btn-primary" rel="popover"
             content="明天需要交货的采购计划" data-disable-with="loading">明天计划</a>
          <a href="@{MaterialUnits.planView(tomorrow2)}" class="btn btn-primary" rel="popover"
             content="后天需要交货的采购计划" data-disable-with="loading">后天计划</a>
          <a href="@{MaterialUnits.planView(tomorrow3)}" class="btn btn-primary" rel="popover"
             content="第三天需要交货的采购计划" data-disable-with="loading">大后天计划</a>
        </div>
        <div class="inline">
          <a href="@{Excels.deliveryments(p)}" class="btn btn-success" target="_blank"><i
              class="icon-download-alt"></i>导出物料计划${str}</a>
        </div>
      </div>
    </div>
  </form>
</div>

<form method="post" id="create_materialUnit">
  <div class="row-fluid">
    <div class="span12">
    #{render 'MaterialUnits/_unit_list.html', units: p.query(), p:p, checkbox:true , materialUnitsIndex:true/}
    </div>
  </div>

  <div class="row-fluid">
    <div class="span12">
      <div class="input-append">
        <input type="text" id="name_deliverplan" name="deliverName" value="${name}" placeHolder="物料出货单的别名(必须)">
        <button id="create_deliverplan_btn" class="btn btn-primary" data-disable-with='添加中'>
          添加出货单
        </button>
      </div>
    </div>
  </div>

</form>


<!--  修改签收数量 弹出div begin   -->
<div id="bom_modal" class="modal hide fade">
  <div class="modal-header">
    <h4>签收数量修改</h4>
  </div>
  <div class="modal-body" style="height:300px;">
    <form action="@{MaterialPlans.updateMaterialPlanUnit()}" method="post" id="updateUnit_form">
      <input type="hidden" name="unit.id" id="unit_id">
      <table class="table table-condensed table-bordered">
        <tr>
          <th width="30%">实际签收数量</th>
          <td>
            <input type="text" placeHolder="实际签收数量" id="unit_receiptQty" name="unit.receiptQty">
          </td>
        </tr>
      </table>
    </form>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
    <button class="btn btn-primary" id="submitUpdateBtn">提交</button>
  </div>
</div>
<!--  修改签收数量 弹出div end   -->

#{records records:logs/}


