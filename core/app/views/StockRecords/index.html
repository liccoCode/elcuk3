#{extends 'main_full.html'/}
#{set title:'库存异动记录(' + records.size() + ')'/}
#{set 'moreScripts'}
    #{script_cdn name: 'component/pagination.coffee'/}
    #{script_cdn name: 'inboundrecords/index.coffee'/}
#{/set}
#{flash_alert /}


<form action="@{StockRecords.index()}" method="get" class="search_form" id="search_form">
  <div class="row-fluid">
    <div class="span12">
      <div class="input-prepend input-append inline">
        <span class="add-on">From:</span>
        <input type="date" name="p.from" value="${p.from.date()}">
        <span class="add-on">To:</span>
        <input type="date" name="p.to" value="${p.to.date()}">
      </div>

      <select name="p.whouse.id" class="inline">
        <option value="">仓库</option>
      #{list items:whouses, as:'whouse'}
        <option ${whouse.id == p.whouse?.id ? 'selected' : ''} value="${whouse.id}">
        ${whouse.name}
        </option>
      #{/list}
      </select>

      <div class="input-prepend input-append inline">
        <span class="add-on"><i class="icon-search"></i></span>
        <input type="text" name="p.search" placeholder="物料编码" value="${p.search}" style="width:
        100px;">
        <button class="btn btn-primary" data-loading>搜索</button>
      </div>

      <div class="inline">
        <a href="@{Excels.stockRecords(p)}" target="_blank" class="btn btn-info inline">盘点</a>
      </div>
    </div>


    <div class="row-fluid">
      <div class="span12">
        <table class="table table-condensed table-bordered">
          <tr>
            <th>仓库</th>
            <th>物料编码</th>
            <th>名称</th>
            <th>FBA</th>
            <th>FBA 仓库</th>
            <th>运输方式</th>
            <th>异动时间</th>
            <th>异动数量</th>
            <th>异动来源</th>
            <th>记录 ID</th>
          </tr>
        #{list items: records, as: 'r'}
            #{set preRecord: r_isFirst ? null : records.get(r_index - 2)/}
            #{set atts: r.stockObj.attributes()/}
          <tr class="${atts.get('fba') != null && atts.get('fba') != preRecord?.stockObj?.attributes()?.get('fba')? 'striped' : ''}">
            <td>
                #{if r.whouse.name != preRecord?.whouse?.name}
                  ${r.whouse.name}
                #{/if}
            </td>
            <td>
              <a href="${r.stockObj.showStockObjLink()}" target="_blank">${r.stockObj.stockObjId}</a>
            </td>
            <td>${r.stockObj.name()}</td>
            <td>
            ${atts.get('fba')}
            </td>
            <td>${atts.get('whouseName')}</td>
            <td>${atts.get('shipType')}</td>
            <td>#{time_tooltip time: r.createDate, datetime: true/}</td>
            <td>${r.qty}</td>
            <td>${r.recordOrigin()}</td>
            <td>
              <a href="${r.showRecordLink()}" target="_blank">${r.type.label()}记录 ${r.recordId}</a>
            </td>
          </tr>
        #{/list}
        </table>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span12">
      #{if records.size() == 0}
        暂时还没有库存异动记录
      #{/if}
      #{else }
          #{bootstrap_pager pi:p, url:'' /}
      #{/else}
      </div>
    </div>
  </div>
</form>

