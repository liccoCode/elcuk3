#{extends 'main_full.html'/}
#{set title:'用户管理界面 (' + users.size() + ')'/}
#{set 'moreScripts'}
    #{script 'users/index.coffee'/}
#{/set}

<div class="row-fluid">
    <div class="span12">
        <table class="table table-bordered table-condensed">
            <tr>
                <th>#</th>
                <th>Username</th>
                <th>Email</th>
                <th>Privileges</th>
            </tr>
        #{list items:users, as:'user'}
            #{ifnot user.username == 'root'}
                <tr>
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td data-toggle="toggle" data-target="#${user.username}_privileges">
                        <i class="icon-reorder"></i> ${user.privileges.size()} 个权限(共 ${privileges.size()} 个)
                    </td>
                </tr>
                <tr id="${user.username}_privileges" style="display:none;">
                    <td colspan="4">
                        <form method="post" action="@{Users.privileges()}" class="privilege_form">
                            <table class="table table-bordered table-condensed">
                            <tr>
                                #{list items:privileges, as:'up'}
                                    <td colspan="${privileges.size() == up_index ? (privileges.size() - (up_index % 8)) : '1'}">
                                        <label class="checkbox">
                                            <input type="checkbox" name="privilegeId" value="${up.id}" ${user.isHavePrivilege(up) ? 'checked' : ''}>
                                            <a href="javascript:;" rel="tooltip" title="${up.name}">${up.memo}</a>
                                        </label>
                                    </td>
                                    #{if up_index % 8 == 0}
                                    </tr>
                                    <tr>
                                    #{/if}
                                #{/list}
                            </tr>
                                <tr>
                                    <td colspan="8">
                                        <input type="hidden" name="id" value="${user.id}">
                                        <button class="btn btn-primary">提交</button>
                                    </td>
                                </tr>
                            </table>
                        </form>
                    </td>
                </tr>
            #{/ifnot}
        #{/list}
        </table>
    </div>
</div>
