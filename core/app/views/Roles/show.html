#{extends 'main_full.html'/}
#{set title:'Role' /}
#{set 'moreScripts'}
    #{script 'roles/show.coffee'/}
#{/set}
<div class="row-fluid">
#{if roles.size() == 0}
  <div>
    等待添加新Role
  </div>
  <div>
    <a href="@{Roles.blank()}" class="btn btn-primary">创建新 Role</a>
  </div>
#{/if}
#{else }
  <div class="row-fluid">
    <div class="span2 well well-small" id="role_slider">
      <table class="table table-bordered table-condensed">
        <tr>
          <th>Name</th>
        </tr>
          #{list items:roles, as:'role_left'}
            <tr>
              <td>
                <a href="@{Roles.show()}/${role_left.roleId}">${role_left.roleName}</a>
              </td>
            </tr>
          #{/list}
      </table>
      <a href="@{Roles.blank()}" class="btn btn-primary">创建新 Role</a>

      <form action="@{Roles.delete()}" method="post" style="display:inline-block;">
        <input type="hidden" name="id" value="${role?.roleId}">
          #{authenticityToken /}
        <button data-confirm='确认删除?' class="btn btn-danger">删除 Role: ${role}</button>
      </form>
    </div>

    <div class="span8 well well-small" id="team_detail">
        #{flash_alert /}
        #{errorMsgs /}

        #{info_row title:'Basic Info'}
        #{/info_row}
      <div>
        <form action="@{Roles.update()}" method="post">
          <table class="table table-bordered table-condensed">
            <tr>
              <td>RoleName:</td>
              <td>
                <input class="input-medium" type="text" name="role.roleName" value="${role.roleName}">
              </td>
              <td>Memo:</td>
              <td>
                <textarea name="role.memo" class="span12" rows="1">${role.memo}</textarea>
              </td>
            </tr>
            <tr>
              <td colspan="4">
                <input type="hidden" name="role.roleId" value="${role.roleId}">
                <button class="btn btn-primary" data-loading>保存</button>
              </td>
            </tr>
          </table>
        </form>
      </div>


        #{info_row title:'菜单权限'/}
      <div class="row-fluid">
        <div class="span12">
          <table class="table table-bordered table-condensed">
            <tr>
              <td colspan="12">
                <form method="post" action="@{Roles.addPrivileges()}" class="privilege_form">
                  <table class="table table-bordered table-condensed">
                  <tr>
                      #{list items:privileges, as:'up'}
                        <td colspan="${privileges.size() == up_index ? (privileges.size() - (up_index % 8)) : '1'}">
                          <label class="checkbox">
                            <input type="checkbox" name="privilegeId" value="${up.id}" ${role.isHavePrivilege(up) ?
                            'checked' : ''}>
                            <a href="javascript:;" rel="tooltip" title="${up.name}">${up.memo}</a>
                          </label>
                        </td>
                          #{if up_index % 8 == 0}
                          </tr>
                          <tr>
                          #{/if}
                      #{/list}
                  </tr>
                    <tr>
                      <td colspan="8">
                        <input type="hidden" name="id" value="${role.roleId}">
                        <button class="btn btn-primary">提交</button>
                      </td>
                    </tr>
                  </table>
                </form>
              </td>
            </tr>


          </table>
        </div>
      </div>

        #{info_row title:'用户'/}
      <div class="row-fluid">
        <div class="span12">
          <table class="table table-bordered table-condensed">
            <tr>
              <th>username</th>
              <th>email</th>
            </tr>
              #{list items:role.users, as:'usr'}
                <tr>
                  <td>${usr.username}</td>
                  <td>${usr.email}</td>
                </tr>
              #{/list}
          </table>
        </div>
      </div>


    </div>
  </div>
</div>
#{/else}
</div>