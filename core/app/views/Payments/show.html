#{extends 'main_full.html' /}
#{set title:"支付单信息"  /}
#{set 'moreStyles'}
    #{stylesheet 'payments.css'/}
#{/set}
#{set 'moreScripts'}
    #{script 'payments.coffee'/}
    #{script 'jquery.filedrop.js'/}
    #{script 'component/dropUpload.coffee'/}
#{/set}
<div>
    <div class="row-fluid">
        <div class="input-prepend span2 offset1">
            <span class="add-on">#</span>
            <input id="paymentId" readonly="true" type="text" value="${payment.id}">
        </div>
        <div class="input-prepend span5">
            <span class="add-on">Title</span>
            <input type="text" class="input-xxlarge" placeholder="标题, TBD" value="">
        </div>
    </div>

    <div class="row-fluid">
    #{errorMsgs /}
    #{flash_alert /}
        <div class="btn-group">
            <button id="select_all" class="btn btn-small">全选</button>
            <button id="select_inverse" class="btn btn-small">反选</button>
        </div>
        <div class="btn-group">
            <button id="approval" url='@{Payments.approval(payment.id)}' class="btn btn-small btn-primary">
                批准
            </button>
            <button id="deny" url='@{Payments.deny(payment.id)}' class="btn btn-small btn-danger">
                驳回
            </button>
        </div>
    #{form @Payments.show(payment.id), id:'unit_list', method:'POST'}
        <table class="table table-bordered table-condensed table-checkboxk">
            <tr>
                <th class="three"></th>
                <th>#</th>
                <th>外键</th>
                <th>总金额</th>
                <th>费用类型</th>
                <th>状态</th>
            </tr>
            #{list items:payment.units,as:'fee'}
                <tr class="${fee.remove ? 'error' : 'success'}">
                    <td>
                        #{if fee.remove}
                            <i class="icon-remove"></i>
                        #{/if}
                        #{else }
                            <label>
                                <input type="checkbox" name="unitIds" value="${fee.id}">
                            </label>
                        #{/else}
                    </td>
                    <td>${fee.id}</td>
                    <td>#{render './_foreignKey.html', fee:fee /}</td>
                    <td>${fee.currency.symbol()} ${fee.amount}</td>
                    <td>${fee.feeType.nickName}</td>
                    <td style="color:${fee.stateColor()}">${fee.state}</td>
                </tr>
            #{/list}
        </table>
    #{/form}
    #{if payment.state == models.finance.Payment.S.WAITING}
        #{form @Payments.paid(payment.id), class: 'form-inline'}
            <input type="text" name="currency" class="input-mini" value="${payment.currency}" readonly="">

            #{if targets.size() <= 0}
                #{a @PaymentTargets.index(), class:'btn btn-success'}添加支付目标#{/a}
            #{/if}
            #{else }
                #{select 'targetId', items:targets, valueProperty:'id', labelProperty:'name'}#{/select}
            #{/else}

            <div class="input-append">
                <input type="text" id="actualPaid" name="actualPaid" placeholder="金额">
                <input type="submit" id="paid" url='@{Payments.paid(payment.id)}' class="btn btn-success" value="付款"/>
            </div>
        #{/form}
    #{/if}
    </div>
    <div class="row-fluid">
        <div class="span4">
            <dl class="dl-horizontal">
                <dt>状态(排除删除的)</dt>
                <dd>数量</dd>

                <dt style="color:${models.finance.PaymentUnit.S.APPLY.stateColor()}">已申请</dt>
                <dd>${payment.unitsStateSize(models.finance.PaymentUnit.S.APPLY)}</dd>

                <dt style="color:${models.finance.PaymentUnit.S.APPROVAL.stateColor()}">批准</dt>
                <dd>${payment.unitsStateSize(models.finance.PaymentUnit.S.APPROVAL)}</dd>

                <dt style="color:${models.finance.PaymentUnit.S.PAID.stateColor()}">已支付</dt>
                <dd>${payment.unitsStateSize(models.finance.PaymentUnit.S.PAID)}</dd>

                <dt style="color:${models.finance.PaymentUnit.S.DENY.stateColor()}">驳回</dt>
                <dd>${payment.unitsStateSize(models.finance.PaymentUnit.S.DENY)}</dd>
            </dl>
        </div>

        <div class="span4">
            <dl class="dl-horizontal">
                <dt>类型</dt>
                <dd>需要付款的金额</dd>

            #{set totalFee: payment.totalFees()/}

                <dt>美元支付</dt>
                <dd>${helper.Currency.USD.symbol()} ${totalFee._1}</dd>

                <dt>人民币支付</dt>
                <dd>${helper.Currency.CNY.symbol()} ${totalFee._2}</dd>

                <dt>USD to CNY</dt>
                <dd>${helper.Currency.USD.ratio(helper.Currency.CNY)}</dd>
            </dl>
        </div>

        <div class="span4">
            <dl class="dl-horizontal">
                <dt>支付状态</dt>
                <dd>${payment.state}</dd>

                <dt>币种</dt>
                <dd>${payment.currency.symbol()}</dd>

                <dt>金额</dt>
                <dd>${payment.actualPaid}</dd>

                <dt>支付账号</dt>
                <dd>${payment.target.accountNumber}</dd>
            </dl>
        </div>
    </div>

    <div class="row-fluid">
        <div id="exchange">
            <div id="exchange_rate" class="span6"></div>
            <div class="span6">
                <p>
                    <a href="http://www.boc.cn/sourcedb/whpj/" target="_blank">
                        中国银行外汇挂牌 <i class="icon-external-link"></i>
                    </a>
                </p>

                <p class="muted">
                    <button class="btn btn-mini" id="refreshRate">
                        <i class="icon-refresh"></i>
                    </button>
                    <i class="icon-info-sign" style=""></i> 仅供参考
                </p>
            </div>
        </div>
    </div>

    <div class="row-fluid">
        <div style="min-height:300px;background:#eee;" id="dropbox">
            <ul class="thumbnails uploaded"></ul>
            <div class="message" style="height:150px;padding-top:145px;text-align:center;">
                Drag & Drop
            </div>
        </div>
    </div>
</div>
