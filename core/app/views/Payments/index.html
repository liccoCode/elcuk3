#{extends 'main_full.html' /}
#{set title:"付款单列表"  /}
#{set 'moreStyles'}
    #{stylesheet 'payments.css'/}
#{/set}
#{set 'moreScripts'}
#{/set}

#{info_row title: "请款项目"}
<ul>
  <li class="text-warning">分页与搜索后续补上</li>
</ul>
#{/info_row}
#{form @Payments.index(), class:'search_form', id:'payments_form'}
<div class="row-fluid">
  <div class="span12">
    <div class="input-prepend input-append inline">
      <span class="add-on">From:</span>
      <input type="date" name="p.from" value="${p.from.date()}">
      <span class="add-on">To:</span>
      <input type="date" name="p.to" value="${p.to.date()}">
    </div>

    <div class="inline">
        #{select_enum name:'p.dateType', items:models.view.post.PaymentsPost.DateType.values() , value: p.dateType /}

        #{select_enum name:'p.state', items:models.finance.Payment.S.values() , value: p.state }
          <option value="">状态</option>
        #{/select_enum}

        #{select 'p.cooperId', items:cooperator, labelProperty:'name', valueProperty:'id' ,value: p.cooperId }
            #{option ''}合作伙伴#{/option}
        #{/select}

        #{select name:'p.actualCurrency', items:helper.Currency.values() , value: p.actualCurrency }
            #{option ''}支付币种#{/option}
        #{/select}

      <span class="add-on">付款时间:</span>
      <input type="date" name="p.paymentDate" value="${p.paymentDate.date()}">

      <span class="add-on">支付账号:</span>
      <input type="text" name="p.actualAccountNumber" value="${p.actualAccountNumber}">
    </div>

    <div class="input-prepend input-append inline">
      <span class="add-on"><i class="icon-search"></i></span>
      <button class="btn btn-primary" data-loading>搜索</button>
    </div>

  </div>
</div>

<div class="row-fluid">
  <table class="table table-bordered table-condensed">
    <tr>
      <th class="">请款单编号</th>
      <th class="ten">涉及的请款人</th>
      <th class="ten">支付人</th>
      <th>合作伙伴</th>
      <th class="ten">状态</th>
      <th class="ten">总请款金额</th>
      <th class="ten">总实际支付金额</th>
      <th>最近更新时间</th>
      <th>创建时间</th>
    </tr>
      #{list items:payments, as:'pay'}
        <tr>
          <td><a href="@{Payments.show(pay.id)}">${pay.paymentNumber}</a></td>
          <td>
              #{list items:pay.applyers(), as:'applyer'}
              ${applyer.username} &nbsp;
              #{/list}
          </td>
          <td>${pay.payer?.username}</td>
          <td>
              #{list items:pay.cooperators(), as:'cop'}
            ${cop.fullName}
          #{/list}
          </td>
          <td style="color:${pay.stateColor()}">${pay.state.label()}</td>
          <td>
            <a href="javascript:;"
               rel="tooltip"
               title="参考汇率: ${helper.Currency.USD.ratio(helper.Currency.CNY)} CNY: ${pay.totalFees()._2}">
            ${helper.Currency.USD.symbol()} ${pay.totalFees()._1.format('#.##')}
            </a>
          </td>
          <td>
          ${pay.actualCurrency?.symbol()} ${pay.actualPaid}
            <i class="badge badge-info">${pay.units().size()}</i>
          </td>
          <td>#{time_tooltip time:pay.updateAt, datetime:true/}</td>
          <td>#{time_tooltip time:pay.createdAt, datetime:true/}</td>
        </tr>
      #{/list}
  </table>
</div>
#{/form}
