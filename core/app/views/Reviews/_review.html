<table class="table table-condensed table-bordered">
    <tr>
        <th>#</th>
        <th>Sku</th>
        <th>Asin</th>
        <th>Create</th>
        <th>LastMsg</th>
        <th rel="popover" placement="bottom" content="黑色数字为 Review 字数<br><br>橙色数字为客户回复数<br><br>蓝色数字为我方回复数;<br><br>黑色对话框表示在 Amazon 上留了 Comment">
            <i class="icon-question-sign"></i> Title
        </th>
        <th>ReviewId</th>
        <th>OsTicket</th>
        <th>UserName</th>
        <th>Score</th>
    </tr>
#{list items:tickets, as:'t'}
    #{set r:t.review/}
    <tr>
        <td>${t.id}</td>
        <td>
            <a href="@{Products.show(t.fid)}" target="_blank">${t.fid}</a>
        </td>
        <td>
            #{set lid:models.market.Listing.unLid(r.listingId)/}
            <a href="@{AmazonReviews.index()}#${lid._1}/${lid._2}" target="_blank">${lid._1}</a>
        </td>
        <td>
            #{if t.createAt}
            ${t.createAt.since()}
            #{/if}
            #{else }
                <i class="icon-warning-sign"></i>
            #{/else}
        </td>
        <td>
            #{if t.lastMessageTime}
            ${t.lastMessageTime.since()}
            #{/if}
            #{else }
                <i class="icon-warning-sign"></i>
            #{/else}
        </td>
        <td data-toggle="toggle" data-target="#toggle_${t.id}" style="cursor:pointer;background:${'#' + r.color()}">
            <span class="badge badge-inverse">${r.length()}</span> |
            #{if t.isStart}
                <span class="badge badge-important"><i class="icon-star"></i></span>
            #{/if}
            <span>${r.title}</span>
            #{list items:t.reasons, as:'ra'}
                <span class="badge badge-important">${ra.name()}</span>
            #{/list}

            <span class="pull-right badge badge-info">${t.responseTimes}</span>
            <span class="pull-right badge badge-warning">${t.messageTimes}</span>

            <!-- 这个是此 Ticket 的处理者 -->
            #{if t.resolver}
                <span class="pull-right badge badge-inverse"><i class="icon-user"></i> ${t.resolver.username.capAll()}</span>
            #{/if}

            <!-- 我们是否在 Amazon 回复了 Comment -->
            #{if r.isCommentOnAmazon}
                <i class="icon-comment"></i>
            #{/if}
        </td>
        <td>
            <a href="@{Reviews.show(r.reviewId)}" target="_blank">
            ${r.reviewId}
            </a>
            #{if r.orderr != null}
                <i class="pull-right icon-shopping-cart"></i>
            #{/if}
        </td>

        <td>
            #{if t.osTicketId()}
                <a href="${t.osTicketLink()}" target="_blank">
                    <i class="icon-external-link"></i> ${t.osTicketId()}
                </a>
            #{/if}
            #{else }
                <i class="icon-warning-sign"></i>
            #{/else}
        </td>
        <td>
            <a href="${r.reviewLink()}" target="_blank">
                <i class="icon-external-link"></i> ${r.username}
            </a>
        </td>
        <td style="background:${'#' + r.rating.color()}">${r.rating}</td>
    </tr>
    <tr id="toggle_${t.id}" style="display:none;">
        <td colspan="10">
            <ul class="nav nav-tabs" style="margin-bottom:3px;">
                <li class="active"><a href="#review_${t.id}" data-toggle="tab">Review</a></li>
                <li><a href="#close_${t.id}" data-toggle="tab">Close</a></li>
            </ul>

            <div class="tab-content" id="tab_content_${t.id}">
                <div id="review_${t.id}" class="tab-pane fade active in" style="background:#fff;">
                    <div>
                        <h3>Review</h3>

                        <p>${r.review}</p>
                        <button tid="${t.id}" class="star_it btn btn-primary">
                            <i class="${t.isStart ? 'icon-star' : 'icon-star-empty'}"></i>
                        </button>
                    </div>
                    <hr>
                    <div>
                        <h3>Review Memo</h3>
                    ${r.comment}
                    </div>
                    <hr>
                    <div>
                        <h3>Ticket Memo</h3>
                        <textarea rows="5" class="span12">${t.memo}</textarea>
                        <button tid="${t.id}" class="ticket_comment btn btn-primary">Comment</button>
                    </div>
                </div>

                <div id="close_${t.id}" class="tab-pane fade" style="background:#fff;">
                    <div class="row-fluid">
                        #{if t.state != models.support.TicketState.CLOSE}
                            <textarea rows="4" id="close_reason_${t.id}" class="span12" placeHolder="输入关闭这个 Ticket 的理由, 必须填写"></textarea>


                            #{if t.reasons.size() == 0}
                                <span class="alert alert-danger">需要先指定原因才可以关闭</span>
                            #{/if}
                            #{else }
                                <button tid="${t.id}" class="close_btn btn btn-danger">
                                    Close
                                </button>
                            #{/else}
                        #{/if}
                        #{else }
                            已经关闭了
                        #{/else}
                    </div>
                </div>
            </div>

        </td>
    </tr>
#{/list}
</table>